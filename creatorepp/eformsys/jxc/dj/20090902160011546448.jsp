<%@ page contentType="text/html; charset=GBK" %><%@page import="com.chinacreator.security.AccessControl"%>
<%@page import="com.frameworkset.common.poolman.DBUtil"%>

<%AccessControl accesscontroler = AccessControl.getInstance();
  accesscontroler.checkAccess(request, response);
  String appPath = "app_"+accesscontroler.getCurrentSystemID();
  String appId = accesscontroler.getCurrentSystemID();
%>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns:fc xmlns:v="urn:schemas-microsoft-com:vml">
	<HEAD>
		<meta http-equiv="Content-Type" content="text/html; charset=GBK">		
		<STYLE> .userData{behavior:url(#default#userData);}
	</STYLE>		
		<script src="../../fceform/js/fcpub.js"></script>
		<script src="../../fceform/js/fcrundj.js"></script>
		<script src="../../fceform/js/tabpane.js"></script>
		<script src="../../fceform/js/ccpub.js" defer></script>
		<script src="../../fceform/js/ccapp_pub.js" defer></script>		
		<script src="../../../eformsys/gaeditor/js/gaeditor.js" defer></script>
		<script src="../../../iWebOffice2006/js/iWebOffice2006.js" defer></script>
		<script langage="javascript">
			//根据应用确定样式的目录
			var stylePath = "../../../ccapp/<%=appPath%>/"; 
			var mylink = document.createElement("link");
			mylink.setAttribute("type","text/css");
			mylink.setAttribute("rel","stylesheet");
			var _my_namespace_js = "<script src='"+stylePath+"js/namespace.js"+"'></"+"script>";
			window.document.write(_my_namespace_js);		
		</script>
		<%@ include file="../../../iWebOffice2006/js/iWebOffice2006Event.jsp"%>
	</HEAD>
	<body background="../../fceform/images/ef_run_background.gif" onload="pub_window_onload()"
		onkeydown="RunTabindex()" onbeforeunload="pub_window_onbeforeunload()" onkeypress="pub_window_onkeypress()"
		onresize="pub_window_onresize()">
		<iframe id="_newframe" name="_newframe" height="0" width="0"></iframe>
		<script>
var pubdjbh=parent.sOpenDjNo;
var pubEdit=false;   			
var pubDataSet=null;
var pubRequest=parent.oRequest;
var pubEformEnterStatus="OK"; 
pub_djhtm();
		</script>
<script type='javascript'>mylink.setAttribute('href',stylePath+'css/creatorBlue/allStyle.css');var myhead = document.getElementsByTagName('head')[0];myhead.appendChild(mylink);fcpubdata.creatorStyle='creatorBlue';</script><script src='../../fceform/js/fcopendj.js'></script><script defer src='../../fceform/js/fcsavedj.js'></script><script src='../../fceform/js/fcselfuse.js'></script><script src='../../fceform/js/fcbasecont.js'></script><script defer src='../../fceform/js/fcother.js'></script><script defer src='../../fceform/js/selectdate.js'></script><script src='../../fceform/../fceformext/js/userfunc.js'></script><script src='../../fceform/js/fcdate.js'></script><link href=../../fceform/css/tabstyle.css type=text/css rel=stylesheet><link rel="stylesheet" type="text/css" href="../../fceform/js/Ext/css/ext-all.css" /><script type="text/javascript" src="../../fceform/js/Ext/ext-base.js"></script><script type="text/javascript" src="../../fceform/js/Ext/ext-all-debug.js"></script><script type="text/javascript" charset="utf-8" src="../../fceform/js/Ext/ext-lang-zh_CN.js"></script><link rel='stylesheet' type='text/css' href='../../fceform/js/Ext/css/SwfUploadPanel.css' /><script type='text/javascript' charset='GBK' src='../../fceform/js/Ext/SwfUpload.js'></script><script type='text/javascript' charset='GBK' src='../../fceform/js/Ext/SwfUploadPanel.js'></script>
<script></script><DIV id=SKbillsheet toolbar="不带工具栏" billtaborder="<root></root>" testDbName dj_sn="20090902160011546448" caption="fsdf" mkbh creatorStyle="creatorBlue" codeheader="BBB" keyfield BLONopen="setAuthority();" BLONclose="UnLoadWebOffice();" window="当前窗口" entertype="修改" creator_remark hasWorkflowButton="否" creator_elementAuthoritySwitch="否" creator_showAlert="是" creator_office_isBindForm="否" islog="否" isprotect="是" posleft postop poswidth posheight isfile="否" OtherSave="否" creator_csslib idtype="1" version="1.0" creator_pagination controlno="SKButton:0;SKDBedit:0;checkbox:0;label:0;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:0;text:0;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:0;dataset:0;spin:0;excel:0;tree:0;ebshow:0;creatorSubForm:0;creator_div:0;ExtGrid:0;ExtUpload:1;ExtTree:0" contxml="<root><ExtUpload><id>ExtUpload1</id></ExtUpload></root>" type="ZW" creatorType="20090825110143218231" jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js&#13;&#10;fcdate.js">&nbsp;
<DIV id=div_ExtUpload1 style="LEFT: 0px; POSITION: static; TOP: 0px"></DIV>&nbsp;
<SCRIPT type=text/javascript>Ext.BLANK_IMAGE_URL = '../../fceform/js/Ext/images/default/s.gif';var w_ExtUpload1 = 399;var h_ExtUpload1 = 224;var upobj_ExtUpload1;var fileListGrid_ExtUpload1;var del_ExtUpload1 = eval('true');var isflow = IsSpace(fcpubdata.cc_form_instanceid)?-1:1;Ext.onReady(function(){var urls = eval('getContextPath()');var _djsn = params("djsn");var _djbh = params("djbh");var urls = urls+'/servlet/CreatorPTServlet?key=ExtUpload';urls += '&uploadid=ExtUpload1';urls += '&djsn='+_djsn;urls += '&djbh='+_djbh;urls += '&savetofile=2';urls += '&savefiledir=';if(isflow==1){urls +='&cc_form_instanceid='+fcpubdata.cc_form_instanceid;}if(IsSpace(_djbh)){alert('djbh不能为空！');return;}var uploadFinishFlag = false;	function createUpload(){	var uploader = new Ext.ux.SwfUploadPanel({		title: '上传文件'		, width: w_ExtUpload1		, height: h_ExtUpload1		,collapsible : true		,file_size_limit : '16000'		,fc_addfiles : true		,fc_delfiles : true		,fc_uploadfiles :true		, upload_url:urls		, flash_url: '../../fceform/js/Ext/swfupload.swf'		, single_file_select: false		, confirm_delete: false		, remove_completed: false        , file_types : '*.*'	});	uploader.on('uploadStart',function(obj,file){		var note = obj.store.getById(file.id).get('note');note=IsSpace(note)?"":note;		this.addPostParam( 'note',note );	});	uploader.on('startUpload', function(t) {	});	uploader.on('fileDialogStart', function(t) {if(uploadFinishFlag) {t.store.removeAll(); uploadFinishFlag=false;};	}); uploader.on('allUploadsComplete', function(t, file){ fileListGrid_ExtUpload1.store.reload();uploadFinishFlag=true;});	upobj_ExtUpload1 = uploader;	return uploader;	}function createGridList(){	var uploadRecode = Ext.data.Record.create([        {name: 'refid', type: 'string'},        {name: 'addTime', type: 'string'},        {name: 'filename', type: 'string'},        {name: 'filetype', type: 'string'},        {name: 'note', type: 'string'}    ]);    var store = new Ext.data.Store({        proxy: new Ext.data.HttpProxy({url: urls+'&showlist=showlist'}),        reader: new Ext.data.JsonReader({        totalProperty: 'totalCount',        root: 'result'        },uploadRecode)  });       var sm =new Ext.grid.CheckboxSelectionModel();       sm.handleMouseDown = Ext.emptyFn;        var cm = new Ext.grid.ColumnModel([        new Ext.grid.RowNumberer(),        sm,        {header: '文件名', dataIndex: 'filename',width: '20%',renderer:function(val){return decodeURI(val);}},        {header: '添加时间', dataIndex: 'addTime',width: '20%'},		{header: '类型', dataIndex: 'filetype',width: '20%',renderer:function(val){return decodeURI(val);}},        {header: '备注', dataIndex: 'note',width: '20%',renderer:function(val){return decodeURI(IsSpace(val)?"":val);}}    ]);        cm.defaultSortable = true;if(!del_ExtUpload1){cm.setHidden(1,!del_ExtUpload1);}        var grid = new Ext.grid.GridPanel({        title: '已上传文件列表',        region: 'center',        loadMask: true,        width: w_ExtUpload1,	    height: h_ExtUpload1,             margins : '0 0 0 0',        store: store,        cm: cm,        sm: sm,        tbar: [        {            text: '删除',        iconCls:'deletepanel',            xtype:del_ExtUpload1?"":'hidden',            handler :deleteGrid        },'->'        ],        viewConfig: {        columnsText:'显示的列',        sortAscText:'升序',        sortDescText:'降序',        forceFit: true		}    });	grid.on('rowdblclick',function(g,index){		 window.open(getContextPath()+'/servlet/CreatorPTServlet?key=Extdownload&refid='+g.getStore().getAt(index).get('refid'));	});    store.load();	fileListGrid_ExtUpload1  = grid ;    return grid;}function deleteGrid(){ var rows = fileListGrid_ExtUpload1.getSelectionModel().getSelections();				if(rows.length==0){				Ext.MessageBox.alert('警告', '最少选择一条信息，进行删除!');				}else{				Ext.MessageBox.confirm('提示框', '您确定要进行该操作？',function(btn){				 var delid="";				if(btn=='yes'){    					for(var i=0;i<rows.length;i++){					 delid=delid+rows[i].get('refid')+'^';   					}				  Ext.Ajax.request({                  url : urls,                 method : 'POST',                  params : {                      ids : delid,					  deletes :'delete'	                  },                      success: function(response, options) {                       var responseArray = Ext.util.JSON.decode(response.responseText);                            if(responseArray.success==true){								fileListGrid_ExtUpload1.getStore().reload();                            }                            else{                                Ext.Msg.alert('失败',responseArray.msg);                            }                         }              });				}  		});	}}    var panel = new Ext.TabPanel({             title : '上传控件面板',             renderTo:'div_ExtUpload1',             id : 'div_ExtUpload1',             width : w_ExtUpload1+10,             height : h_ExtUpload1+10,             frame:true,			 activeTab: 0,             margins : '0 0 0 0',             minHeight : 100,             autoHeight : false,             items : [				createUpload(),				createGridList()             ]             });});function dodoupload(){upobj_ExtUpload1.startUpload();}</SCRIPT>
</DIV></body></html>