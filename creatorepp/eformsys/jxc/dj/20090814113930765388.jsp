<%@ page contentType="text/html; charset=GBK" %><%@page import="com.chinacreator.security.AccessControl"%>
<%@page import="com.frameworkset.common.poolman.DBUtil"%>

<%AccessControl accesscontroler = AccessControl.getInstance();
  accesscontroler.checkAccess(request, response);
  String appPath = "app_"+accesscontroler.getCurrentSystemID();
  String appId = accesscontroler.getCurrentSystemID();
%>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns:fc xmlns:v="urn:schemas-microsoft-com:vml">
	<HEAD>
		<meta http-equiv="Content-Type" content="text/html; charset=GBK">		
		<STYLE> .userData{behavior:url(#default#userData);}
	</STYLE>		
		<script src="../../fceform/js/fcpub.js"></script>
		<script src="../../fceform/js/fcrundj.js"></script>
		<script src="../../fceform/js/tabpane.js"></script>
		<script src="../../fceform/js/ccpub.js" defer></script>
		<script src="../../fceform/js/ccapp_pub.js" defer></script>		
		<script src="../../../eformsys/gaeditor/js/gaeditor.js" defer></script>
		<script src="../../../iWebOffice2006/js/iWebOffice2006.js" defer></script>
		<script langage="javascript">
			//根据应用确定样式的目录
			var stylePath = "../../../ccapp/<%=appPath%>/"; 
			var mylink = document.createElement("link");
			mylink.setAttribute("type","text/css");
			mylink.setAttribute("rel","stylesheet");
			var _my_namespace_js = "<script src='"+stylePath+"js/namespace.js"+"'></"+"script>";
			window.document.write(_my_namespace_js);		
		</script>
		<%@ include file="../../../iWebOffice2006/js/iWebOffice2006Event.jsp"%>
	</HEAD>
	<body background="../../fceform/images/ef_run_background.gif" onload="pub_window_onload()"
		onkeydown="RunTabindex()" onbeforeunload="pub_window_onbeforeunload()" onkeypress="pub_window_onkeypress()"
		onresize="pub_window_onresize()">
		<iframe id="_newframe" name="_newframe" height="0" width="0"></iframe>
		<script>
var pubdjbh=parent.sOpenDjNo;
var pubEdit=false;   			
var pubDataSet=null;
var pubRequest=parent.oRequest;
var pubEformEnterStatus="OK"; 
pub_djhtm();
		</script>
<script type='javascript'>mylink.setAttribute('href',stylePath+'css/creatorBlue/allStyle.css');var myhead = document.getElementsByTagName('head')[0];myhead.appendChild(mylink);fcpubdata.creatorStyle='creatorBlue';</script><script src='../../fceform/js/fcopendj.js'></script><script defer src='../../fceform/js/fcsavedj.js'></script><script src='../../fceform/js/fcselfuse.js'></script><script src='../../fceform/js/fcbasecont.js'></script><script defer src='../../fceform/js/fcother.js'></script><script defer src='../../fceform/js/selectdate.js'></script><script src='../../fceform/../fceformext/js/userfunc.js'></script><script src='../../fceform/js/fcdate.js'></script><link href=../../fceform/css/tabstyle.css type=text/css rel=stylesheet><link rel="stylesheet" type="text/css" href="../../fceform/js/Ext/css/ext-all.css" /><script type="text/javascript" src="../../fceform/js/Ext/ext-base.js"></script><script type="text/javascript" src="../../fceform/js/Ext/ext-all.js"></script><script type="text/javascript" charset="utf-8" src="../../fceform/js/Ext/ext-lang-zh_CN.js"></script><link type='text/css' rel='stylesheet' href='../../fceform/css/Button.css'/><link type='text/css' rel='stylesheet' href='../../fceform/css/TextStyle.css'/><link rel='stylesheet' type='text/css' href='../../fceform/js/Ext/css/SwfUploadPanel.css' /><script type='text/javascript' charset='GBK' src='../../fceform/js/Ext/SwfUpload.js'></script><script type='text/javascript' charset='GBK' src='../../fceform/js/Ext/SwfUploadPanel.js'></script>
<script></script><DIV id=SKbillsheet jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js&#13;&#10;fcdate.js" creatorType="20090810102954968085" type="ZW" toolbar="不带工具栏" testDbName dj_sn="20090814113930765388" caption="测试附件与工作流关联" mkbh creatorStyle="creatorBlue" codeheader="BBB" keyfield BLONopen="setAuthority();" BLONclose="UnLoadWebOffice();" window="当前窗口" entertype="修改" creator_remark hasWorkflowButton="否" creator_elementAuthoritySwitch="否" creator_showAlert="是" creator_office_isBindForm="否" islog="否" isprotect="是" posleft postop poswidth posheight isfile="否" OtherSave="否" creator_csslib idtype="1" version="1.0" creator_pagination billtaborder="<root><taborder>workflowControl_selectAct</taborder><taborder>button_xzxr</taborder><taborder>button_yfzxzxr</taborder><taborder>button_qdlc</taborder><taborder>button_wchd</taborder><taborder>button_ht</taborder><taborder>button_hs</taborder><taborder>button_zc</taborder><taborder>button_fh</taborder><taborder>DYNAMICPERFORMER_NAME</taborder><taborder>DYNAMICPERFORMER</taborder><taborder>ANDSPLITUSERS_ACTNAME</taborder><taborder>ANDSPLITUSERS</taborder><taborder>workflowControl_result</taborder></root>" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:0;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:1;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:0;div:0;DsMain_field:0;a:0;button:0;text:0;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:0;dataset:2;spin:0;excel:0;tree:0;ebshow:0;creatorSubForm:0;creator_div:0;ExtGrid:0;ExtUpload:1;ExtTree:0" contxml="<root><combobox><id>workflowControl_selectAct</id></combobox><div><id>workflowControl_selectAct_div</id><id>workflowControl_selectUser</id><id>workflowControl_selectAndUser</id><id>workflowControl_start</id><id>workflowControl_complete</id><id>workflowControl_back</id><id>workflowControl_recycle</id><id>workflowControl_tempSaveForm</id><id>workflowControl_backToPrior</id></div><button><id>button_xzxr</id><id>button_yfzxzxr</id><id>button_qdlc</id><id>button_wchd</id><id>button_ht</id><id>button_hs</id><id>button_zc</id><id>button_fh</id></button><text><id>DYNAMICPERFORMER_NAME</id><id>DYNAMICPERFORMER</id><id>ANDSPLITUSERS_ACTNAME</id><id>ANDSPLITUSERS</id><id>workflowControl_result</id></text><ExtUpload><id>ExtUpload1</id></ExtUpload></root>">&nbsp;
<DIV id=div_ExtUpload1 style="LEFT: 0px; POSITION: static; TOP: 0px"></DIV>&nbsp;
<SCRIPT type=text/javascript>Ext.BLANK_IMAGE_URL = '../../fceform/js/Ext/images/default/s.gif';var w_ExtUpload1 = 593;var h_ExtUpload1 = 343;var upobj_ExtUpload1;var fileListGrid_ExtUpload1;var del_ExtUpload1 = eval('true');var isflow = IsSpace(fcpubdata.cc_form_instanceid)?-1:1;var ExtUpload1_retint = 0;var ExtUpload1_onReady = function(){if(ExtUpload1_retint==0) {ExtUpload1_retint = setInterval(ExtUpload1_onReady,200);return;}if(creator_getSession("cc_form_instanceid")=="null") return;clearInterval(ExtUpload1_retint);ExtUpload1_retint = null ;var urls = eval('getContextPath()');var _djsn = localWindowParams("djsn");var _djid = localWindowParams("djid");var _djbh = localWindowParams("djbh");if(typeof(creator_pt_djbh)!='undefined') _djbh=creator_pt_djbh;var urls = urls+'/servlet/CreatorPTServlet?key=ExtUpload';urls += '&uploadid=ExtUpload1';urls += '&djsn='+_djsn;urls += '&djid='+_djid;urls += '&djbh='+_djbh;urls += '&savetofile=2';urls += '&savefiledir=';if(isflow==1){urls +='&cc_form_instanceid='+fcpubdata.cc_form_instanceid;}var uploadFinishFlag = false;	function createUpload(){	var uploader = new Ext.ux.SwfUploadPanel({		title: '上传文件'		, width: w_ExtUpload1		, height: h_ExtUpload1		,collapsible : true		,file_size_limit : '16000'		,fc_addfiles : true		,fc_delfiles : true		,fc_uploadfiles :true		, upload_url:urls		, flash_url: '../../fceform/js/Ext/swfupload.swf'		, single_file_select: false		, confirm_delete: false		, remove_completed: false        , file_types : '*.txt;*.doc'	});	uploader.on('uploadStart',function(obj,file){		var note = obj.store.getById(file.id).get('note');note=IsSpace(note)?"":note;		this.addPostParam( 'note',note );	});	uploader.on('startUpload', function(t) {	});	uploader.on('fileDialogStart', function(t) {if(uploadFinishFlag) {t.store.removeAll(); uploadFinishFlag=false;};	}); uploader.on('allUploadsComplete', function(t, file){ fileListGrid_ExtUpload1.store.reload();uploadFinishFlag=true;});	upobj_ExtUpload1 = uploader;	return uploader;	}function createGridList(){	var uploadRecode = Ext.data.Record.create([        {name: 'refid', type: 'string'},        {name: 'addTime', type: 'string'},        {name: 'filename', type: 'string'},        {name: 'filetype', type: 'string'},        {name: 'note', type: 'string'}    ]);    var store = new Ext.data.Store({        proxy: new Ext.data.HttpProxy({url: urls+'&showlist=showlist'}),        reader: new Ext.data.JsonReader({        totalProperty: 'totalCount',        root: 'result'        },uploadRecode)  });       var sm =new Ext.grid.CheckboxSelectionModel();       sm.handleMouseDown = Ext.emptyFn;        var cm = new Ext.grid.ColumnModel([        new Ext.grid.RowNumberer(),        sm,        {header: '文件名', dataIndex: 'filename',width: '20%',renderer:function(val){return decodeURI(val);}},        {header: '添加时间', dataIndex: 'addTime',width: '20%'},		{header: '类型', dataIndex: 'filetype',width: '20%',renderer:function(val){return decodeURI(val);}},        {header: '备注', dataIndex: 'note',width: '20%',renderer:function(val){return decodeURI(IsSpace(val)?"":val);}}    ]);        cm.defaultSortable = true;if(!del_ExtUpload1){cm.setHidden(1,!del_ExtUpload1);}        var grid = new Ext.grid.GridPanel({        title: '已上传文件列表',        region: 'center',        loadMask: true,        width: w_ExtUpload1,	    height: h_ExtUpload1,             margins : '0 0 0 0',        store: store,        cm: cm,        sm: sm,        tbar: [        {            text: '删除',        iconCls:'deletepanel',            xtype:del_ExtUpload1?"":'hidden',            handler :deleteGrid        },'->'        ],        viewConfig: {        columnsText:'显示的列',        sortAscText:'升序',        sortDescText:'降序',        forceFit: true		}    });	grid.on('rowdblclick',function(g,index){		 window.open(getContextPath()+'/servlet/CreatorPTServlet?key=Extdownload&refid='+g.getStore().getAt(index).get('refid'));	});    store.load();	fileListGrid_ExtUpload1  = grid ;    return grid;}function deleteGrid(){ var rows = fileListGrid_ExtUpload1.getSelectionModel().getSelections();				if(rows.length==0){				Ext.MessageBox.alert('警告', '最少选择一条信息，进行删除!');				}else{				Ext.MessageBox.confirm('提示框', '您确定要进行该操作？',function(btn){				 var delid="";				if(btn=='yes'){    					for(var i=0;i<rows.length;i++){					 delid=delid+rows[i].get('refid')+'^';   					}				  Ext.Ajax.request({                  url : urls,                 method : 'POST',                  params : {                      ids : delid,					  deletes :'delete'	                  },                      success: function(response, options) {                       var responseArray = Ext.util.JSON.decode(response.responseText);                            if(responseArray.success==true){								fileListGrid_ExtUpload1.getStore().reload();                            }                            else{                                Ext.Msg.alert('失败',responseArray.msg);                            }                         }              });				}  		});	}}    var panel = new Ext.TabPanel({             title : '上传控件面板',             renderTo:'div_ExtUpload1',             id : 'div_ExtUpload1',             width : w_ExtUpload1+10,             height : h_ExtUpload1+10,             frame:true,			 activeTab: 0,             margins : '0 0 0 0',             minHeight : 100,             autoHeight : false,             items : [				createUpload(),				createGridList()             ]             });if(localWindowParams('operType')=='readonly'){panel.setActiveTab(panel.items.item(1));panel.items.item(0).setDisabled(true);panel.items.item(1).getTopToolbar().setVisible(false);}if(typeof(creator_pt_uppanels)=='undefined'){creator_pt_uppanels=new Array();}creator_pt_uppanels.push({id:'ExtUpload1',obj:panel});};function dodoupload(){upobj_ExtUpload1.startUpload();}ExtUpload1_onReady();</SCRIPT>
&nbsp;
<DIV id=workflowControl1 style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; LEFT: 0px; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 100%; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 171.66%" onmovestart=moveStart() controltype="workflowControl" NotBg="是">
<DIV id=workflowControl_selectAct_div style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; FONT-SIZE: 12px; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; BORDER-LEFT: 0px; WIDTH: 215px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px; auto: " onmovestart=moveStart() controltype="div" NotBg="是">请选择活动： <SELECT id=workflowControl_selectAct style="LEFT: 58px; WIDTH: 120px; POSITION: static; TOP: 33px; HEIGHT: 25px" onmovestart=moveStart() onchange='bill_onclick("changeSelectActor()")' controltype="combobox" sql temptext tempvalue check="1" sqltrans></SELECT> </DIV>
<DIV id=workflowControl_selectUser style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; FONT-SIZE: 12px; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 340px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是">请选择执行人： <INPUT id=DYNAMICPERFORMER_NAME style="LEFT: 0px; WIDTH: 150px; POSITION: static; TOP: 0px; HEIGHT: 20px" onmovestart=moveStart() readOnly size=25 controltype="text"> <INPUT id=DYNAMICPERFORMER style="DISPLAY: none; LEFT: 0px; WIDTH: 5px; POSITION: static; TOP: 0px; HEIGHT: 20px" onmovestart=moveStart() size=2 controltype="text"><BUTTON class=button1 id=button_xzxr style="LEFT: 0px; WIDTH: 75px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("adduser();")'>选执行人</BUTTON> </DIV>
<DIV id=workflowControl_selectAndUser style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; FONT-SIZE: 12px; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 380px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是">请选择执行人： <INPUT id=ANDSPLITUSERS_ACTNAME style="LEFT: 0px; WIDTH: 150px; POSITION: static; TOP: 0px; HEIGHT: 20px" onmovestart=moveStart() readOnly size=25 controltype="text"> <INPUT id=ANDSPLITUSERS style="DISPLAY: none; LEFT: 0px; WIDTH: 5px; POSITION: static; TOP: 0px; HEIGHT: 20px" onmovestart=moveStart() size=2 controltype="text"><BUTTON class=button1 id=button_yfzxzxr style="LEFT: 0px; WIDTH: 115px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("addAndUser();")'>与分支选执行人</BUTTON> </DIV>
<DIV id=workflowControl_start style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 84px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是"><BUTTON class=button1 id=button_qdlc style="LEFT: 0px; WIDTH: 75px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick="bill_onclick(&quot;creator_djsave('启动流程',true,true,'../../../common_workflow/main.jsp')&quot;)">启动流程</BUTTON></DIV>
<DIV id=workflowControl_complete style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 84px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是"><BUTTON class=button1 id=button_wchd style="LEFT: 0px; WIDTH: 75px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick="bill_onclick(&quot;creator_djsave('完成活动',true,true,'../../../common_workflow/main.jsp')&quot;)">完成活动</BUTTON></DIV>
<DIV id=workflowControl_back style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 84px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是"><BUTTON class=button1 id=button_ht style="LEFT: 0px; WIDTH: 75px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick="bill_onclick(&quot;creator_djsave('回退',false,true,'../../../common_workflow/main.jsp')&quot;)">回退</BUTTON></DIV>
<DIV id=workflowControl_recycle style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 84px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是"><BUTTON class=button1 id=button_hs style="LEFT: 0px; WIDTH: 75px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick="bill_onclick(&quot;creator_djsave('收回',false,true,'../../../common_workflow/main.jsp')&quot;)">收回</BUTTON></DIV>
<DIV id=workflowControl_tempSaveForm style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 84px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是"><BUTTON class=button1 id=button_zc style="LEFT: 0px; WIDTH: 75px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick="bill_onclick(&quot;creator_djsave('暂存',true,true,'../../../common_workflow/main.jsp')&quot;)">暂存</BUTTON></DIV>
<DIV id=workflowControl_backToPrior style="BORDER-RIGHT: 0px; BORDER-TOP: 0px; OVERFLOW-Y: hidden; LEFT: 0px; FLOAT: left; OVERFLOW-X: hidden; OVERFLOW: auto; BORDER-LEFT: 0px; WIDTH: 84px; BORDER-BOTTOM: 0px; POSITION: static; TOP: 0px; HEIGHT: 30px" onmovestart=moveStart() controltype="div" NotBg="是"><BUTTON class=button1 id=button_fh style="LEFT: 0px; WIDTH: 75px; POSITION: static; TOP: 0px; HEIGHT: 25px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("history.back();")'>返回</BUTTON></DIV><INPUT id=workflowControl_result style="DISPLAY: none; LEFT: 0px; WIDTH: 0px; POSITION: static; TOP: 0px; HEIGHT: 0px" onmovestart=moveStart() controltype="text"></DIV></DIV></body></html>