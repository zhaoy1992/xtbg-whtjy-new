<HTML xmlns:fc xmlns:v="urn:schemas-microsoft-com:vml">
	<HEAD>
	<link rel="stylesheet" type="text/css" href="menu.css">
	<link rel="stylesheet" type="text/css" href="../css/table.css">
	<link href=../css/tabstyle.css type=text/css rel=stylesheet>
		<STYLE> 
				v\:* { BEHAVIOR: url(#default#VML);};
					.subpageDiv { BACKGROUND-COLOR: #ffffff; BORDER-BOTTOM: #0000cd 2px outset; BORDER-LEFT: #0000cd 2px ridge; 
					BORDER-RIGHT: #0000cd 2px outset; BORDER-TOP: #0000cd 2px ridge;  OVERFLOW: auto;  
					WIDTH:210MM; HEIGHT:297MM;padding:5mm; }
				* {font-size: 13px;}	

			</STYLE>
			
		<script src="../js/fcpub.js"></script>
		<script src="../js/design.js"></script>
		<script src="../js/fctorun.js"></script>		
		<script src="../js/fcbasecont.js"></script>
		<script src="../js/fcrundj.js"></script>
		<script src="../js/ccpub.js"></script>
		<script src="../js/table-operations.js"></script>
		<script src="../js/htmlarea.js"></script>				
		<script langage="javascript">
			var mylink = document.createElement("link");
			mylink.setAttribute("type","text/css");
			mylink.setAttribute("rel","stylesheet");
			mylink.setAttribute("href","../css/"+fcpubdata.creatorStyle+"/allStyle.css");
			var myhead = document.getElementsByTagName("head")[0];
			myhead.appendChild(mylink);
		</script>
		<SCRIPT ID="clientEventHandlersJS" LANGUAGE="javascript">
<!--
var editor = null;
var editortab = null;


var	lngUndo = -1 
var	lngRedo = -1
var oUndo = SetDom("<root></root>")
var oRedo = SetDom("<root></root>")

//---------------------
var curdjid=0 //当前打开的表单的ID，=0表示为新建的表单
var pstrUserFunction="" //保存当前表单的自定义函数的内容
var pstrAddHtml="" //保存当前表单的附加页面元素的内容
var pstrSplitAddHtml= "<p id=splitaddhtml />" ;
var blnChange=false //改动标志,为真表示改动了要提示保存
var curSelElement =null //
var strXml;
var strID;
var arrtmp1=new Array();

//控件名称数组
//var ArrName=getControlNameArr()
	var ArrName=new Array();
	ArrName[0]="SKButton";
	ArrName[1]="SKDBedit";
	ArrName[2]="checkbox";
	ArrName[3]="label";
	ArrName[4]="radio" ;
	ArrName[5]="listbox"
	ArrName[6]="textarea"
	ArrName[7]="combobox"
	ArrName[8]="password" ;
	ArrName[9]="upload" ;
	ArrName[10]="SKDBtext";
	ArrName[11]="chart";
	ArrName[12]="dbimg";
	ArrName[13]="img";
	ArrName[14]="SKBILLgrid";
	ArrName[15]="shape";
	ArrName[16]="tab";
	ArrName[17]="div";
	ArrName[18]="DsMain_field";  // SKDBTreeView改为DsMain_field,用来记录最大号
	ArrName[19]="a" ;
	ArrName[20]="button" ;
	ArrName[21]="text" 
	ArrName[22]="hr" ;
	ArrName[23]="checkboxlist"
	ArrName[24]="radiolist"
	ArrName[25]="dropdownlist"
	ArrName[26]="grid"
	ArrName[27]="dataset"
	ArrName[28]="spin"
	ArrName[29]="excel"
	ArrName[30]="tree"
	ArrName[31]="ebshow"; //显示e表控件
	//ArrName[28]="ep_borderstyle"

var oContXml = SetDom("<root></root>"); //保存每个控件ID

var ArrNum=new Array(); //保存每种控件的最大号
//var ArrCom = new Array(new Array()) ; //保存每个控件ID
InitControlNo()
/**
初始化控件数组
**/
function InitControlNo(){
	for(var Num=0;Num<ArrName.length;Num++){
		ArrNum[ArrName[Num]]=0;
		//ArrCom[ArrName[Num]] = new Array() ;
	}

}
/**
*窗体装入事件代码
**/
function window_onload() {
	editor = new HTMLArea();
	editor._doc = document;
	editortab = new TableOperations() ;



//setLinkSrc( "luna" )
  //  SKbillsheet.unselectable = "on";
    SKbillsheet.contentEditable=true
//    SKbillsheet.designMode="On"
	//SKbillsheet.ATOMICSELECTION=true
    document.execCommand("2D-Position", true, true);
    document.execCommand("MultipleSelection", true, true);
  
  SKbillsheet.focus() ;
  //为了支持一进入设计界面时就以设计模式打开某张表单
  if(isSpace(parent.topdjid) == false)//有djid的情况
  {
		var sdjid=parent.topdjid;
		//CopyToPub(sdjid)
		DesignDjOpen(sdjid)
		//为了快速重新保存一下多个表单
		if(parent.Request.QueryString("resave").toString() == "yes"){
			SKbillsheet.contxml = "";
			oContXml = null ;
			DesignDjSave("不提示","是");
	  }  
	}
  else if(isSpace(parent.topdjsn) == false){
		var sql="select djid from FC_BILLZL where djsn='"+parent.topdjsn+"'";
		//CopyToPub(sql)
		var sdjid=SqlToField(sql);
		//CopyToPub(sdjid)
		DesignDjOpen(sdjid)
		//为了快速重新保存一下多个表单
		if(parent.Request.QueryString("resave").toString() == "yes"){
			SKbillsheet.contxml = "";
			oContXml = null ;
			DesignDjSave("不提示","是");
		}
  }else if(parent.Request.QueryString("ebuse").toString() == "yes"){ //e表用
		e_opendj();
  }else{
		//yes/no 用来决定是否是加控件时自动加字段
		fcpubvar.AutoAddField = parent.Request.QueryString("autoaddfield").toString();
		AutoAddDsMain();
		var startpage = "" ;
		startpage = parent.Request.QueryString("startpage").toString();
		if(startpage != "no" ){
			//起始页
			//DjOpen("fcs_origPage",parent,"展现","有模式窗口","直接","起始页");
		}		
  }
  
  
	window_onresize();
	if(parent.menu.pubPositionChange == "是"){
		fcpubdata.position="absolute";
	}
	
}
function window_onclick() {
	var obj = event.srcElement ;
	var sid = event.srcElement.id ;
	if(sid=="mainbody" || sid == "bigmain" || sid == "middlediv" || sid == "SKbillsheet" ){
		curSelElement=null ;
	}else if(obj.tagName == "TD") {
		try {
			var oP = obj.parentNode.parentNode.parentNode.parentNode ;
			if(oP.controltype == "tab") {
				curSelElement=null ;
				return ;
			}
		}catch(e){} ;
		curSelElement = event.srcElement;
	}
	

}
function resize() {
	ActMoveResize()
}

function move(){
	ActMoveResize()
}
/**
处理在页签控件上移动和调整控件时不能移到页签控件的外面
**/
function ActMoveResize() {
	
   var o=event.srcElement
   if(o == null)return;
   var oP=o.parentNode
   if(oP.tagName=="DIV" && oP.id=="fcpagesub"){
		
		var opwidth=oP.parentNode.style.posWidth
		if(typeof opwidth == "undefined") opwidth=oP.offsetWidth
		var opheight=oP.style.posHeight
		if(typeof opheight == "undefined") opheight=oP.offsetHeight
		
		if(o.offsetWidth>opwidth){
			o.style.width=opwidth
		}
		if(o.offsetHeight>opheight){
			o.style.height=opheight
		}
		if( o.offsetTop>opheight-o.offsetHeight){
		   //window.status="up:"+o.offsetTop
		  // event.returnValue=false
		  o.style.top=opheight-o.offsetHeight  //oP.offsetHeight-5
			
		}
		if(o.offsetLeft>opwidth-o.offsetWidth){
		  o.style.left=opwidth-o.offsetWidth //oP.offsetWidth-5
		
		}
		if(o.offsetTop<0){
			o.style.top=0
		}
		if(o.offsetLeft<0){
			o.style.left=0
		}
   }
   blnChange=true

}
/**
*当控件选择时给当前控件的全局变量
**/

function controlselect() {
	if(event.srcElement.id =="fcpagesubtable") {
		event.returnValue = false;
		return ;
	}
	curSelElement=event.srcElement ;
}
function controlselectcancel() {
	event.returnValue=false
}
/**
打开表单时调用
**/
function pageonload(){
	var oNode = oContXml.documentElement.selectSingleNode("tab") ;
	if(oNode != null ){
		var l=oNode.childNodes.length;
		for(var i=0;i<l;i++){
			var obj = eval(oNode.childNodes(i).text)
			
			//隐藏其它页的select控件
			var oPP=obj;
			var ll=oPP.childNodes.length;
			for(var ii=2;ii<ll;ii++){
				HideListBox(oPP.childNodes(ii),"是")
			}
			//try{
				HideListBox(oPP.childNodes(1),"否")		
			//}catch(E){}
		}			
	}
}
function CancelEvent(){
	if(event.srcElement.id=="fcpagesub" || event.srcElement.id=="fcpagesubtable" )
		event.returnValue=false;
}
function page_onresize(){

//调整子页的大小和页面控件同步
	var obj=event.srcElement
	var l=obj.childNodes.length
	var iWidth=obj.style.posWidth-2
	var iHeight=obj.style.posHeight-20
	if(iHeight<0){
		iHeight=0;
		obj.style.height=20;
	}
	for(var i=1;i<l;i++){
		obj.childNodes(i).style.posWidth=iWidth
		obj.childNodes(i).style.posHeight=iHeight
	}
}
function pageonclick() {
	//alert("dddd")
	var obj=event.srcElement
	//alert(obj.tagName)
	if(obj.tagName=="FONT") obj=obj.parentNode
	if(obj.tagName=="TD"){
		var index=obj.cellIndex
		var oTr=obj.parentNode
		var oP=oTr.parentNode.parentNode //table
		var oPP=oP.parentNode  //整个页签控件
		var l=oPP.childNodes.length;
		for(var i=1;i<l;i++){
			oPP.childNodes(i).style.zIndex=0
			//oPP.childNodes(i).style.display="none"

			oTr.cells(i-1).style.color="black"
			HideListBox(oPP.childNodes(i),"是")
		}
			oPP.childNodes(index+1).style.zIndex=1
			//oPP.childNodes(index+1).style.display="block"
			oTr.cells(index).style.color="red"
			HideListBox(oPP.childNodes(index+1),"否")
	}	
	/*
	if(obj.tagName=="A"){
		var oP=obj.parentNode.parentNode
	}else{
		var oP=obj.parentNode
	}
	var oPP=oP.parentNode  //整个页签控件
	var l=oPP.childNodes.length;
	for(var i=1;i<l;i++){
		oPP.childNodes(i).style.zIndex=0
	}
		oPP.childNodes(index).style.zIndex=1

	var oControlRange = document.body.createControlRange()  ;
	oControlRange.add(oPP.childNodes(index)) ;
	oControlRange.select() ;
	*/	

}
/**
* 换页时隐藏select控件
**/
function HideListBox(oPage,sTag){
	var sTag1
	var oList=oPage.all.tags("select")
	
	var l=oList.length
	if(sTag=="是"){
		for(var i=0;i<l;i++){
			if(oList(i).style.posWidth>0){
				oList(i).backwidth=oList(i).style.posWidth
				oList(i).backheight=oList(i).style.posHeight
				oList(i).style.posWidth=0
				oList(i).style.posHeight=0
			}
		}
	}else{
		for(var i=0;i<l;i++){
			if(isSpace(oList(i).backwidth)==false){
				oList(i).style.width=oList(i).backwidth
				oList(i).style.height=oList(i).backheight
			}
		}
	
	}

}



/**
	点击焦点次序时把界面上的所有的控件ID拼成XML串
	@date 2004-07-13
	@return 返回XML串"<root><taborder>SKButton1</taborder><taborder>SKButton2</taborder><root>"
**/		
function TaborderXml(){
	var l
	var l1
	var arrC=new Array()
	//下列控件有焦点
	arrC[0]=ArrName[0]
	arrC[1]=ArrName[1]
	arrC[2]=ArrName[2]
	arrC[3]=ArrName[4]
	arrC[4]=ArrName[5]
	arrC[5]=ArrName[6]
	arrC[6]=ArrName[7]
	arrC[7]=ArrName[14]
	arrC[8]=ArrName[20]
	arrC[9]=ArrName[21]
	arrC[10]=ArrName[25]
	arrC[11]=ArrName[26]
	arrC[12]=ArrName[28]
	if(isSpace(SKbillsheet.billtaborder)){
		strID="<root>";
		l=arrC.length
		for (var ilen=0;ilen<l;ilen++){
			var oNode = oContXml.documentElement.selectSingleNode(arrC[ilen])
			if( oNode  == null ) continue ;
			l1=oNode.childNodes.length
			for(var k=0;k<l1;k++){
				strID=strID+"<taborder>"+oNode.childNodes(k).text+"</taborder>";
			}
			/*
			l1=ArrNum[arrC[ilen]]
			for(var k=1;k<=l1;k++){
				try{
					obj=eval(arrC[ilen]+k);
					strID=strID+"<taborder>"+arrC[ilen]+k+"</taborder>";
				}catch(e){
					sfind="<taborder>"+arrC[ilen]+k+"</taborder>";
					if(strID.indexOf(sfind)>0){
						strID=RepStr(strID,sfind,"");
					}
				}
			}*/
		}
		strID=strID+"</root>";
	}else{
		//先去掉在taborder中存在而在oContXml中不存在的控件
		var sxml = SKbillsheet.billtaborder ;
		var oX = SetDom(sxml) ;
		var l = oX.documentElement.childNodes.length ;
		for(var i=l-1;i>=0;i--){
			var oNode = oContXml.documentElement.selectSingleNode("//id[. ='"+oX.documentElement.childNodes(i).text+"']") ;
			if( oNode  == null ) {
				oX.documentElement.removeChild(oX.documentElement.childNodes(i));
			}
		}
		sxml=oX.documentElement.xml ;
		//加上新的控件
		strID=RemoveRoot(sxml);
		l=arrC.length
		for (var ilen=0;ilen<l;ilen++){
			var oNode = oContXml.documentElement.selectSingleNode(arrC[ilen])
			if( oNode  == null ) continue ;
			l1=oNode.childNodes.length
			for(var k=0;k<l1;k++){
				var sfind = "<taborder>"+oNode.childNodes(k).text+"</taborder>";
				//如不存在,则加上
				if(strID.indexOf(sfind)<0){ 
					strID=strID+sfind
				}
			}
		
			/*
			l1=ArrNum[arrC[ilen]]
			for(var k=1;k<=l1;k++){
				try{
					obj=eval(arrC[ilen]+k);
					sfind="<taborder>"+arrC[ilen]+k+"</taborder>";
					if(strID.indexOf(sfind)<0){
						strID=strID+sfind;
					}
				}catch(e){
					sfind="<taborder>"+arrC[ilen]+k+"</taborder>";
					if(strID.indexOf(sfind)>=0){
						strID=RepStr(strID,sfind,"");
					}
				}
			}
			*/
		}
		strID = "<root>" + strID + "</root>" ;
	}
	return strID;
}
/**
表单保存
   保存表单：
   	0 合法性检查，单据SN重名检查，
   	1 预处理控件，如将表单控件进行转换后得到新的大HTML串
   	2 创建临时表
   	3 根据djid决定是INSERT还是UPDATE，只保存FC_BILLZL表中的几个字段：djid djsn djposition xmlstr
   	
   	用一个存储过程来保存表单，
   	此过程做如下工作：
   	  1 检查单据SN是否重名，如重名则保存完后给出提示。
   	  2 创建临时表。根据前台传来的命令创建。
   	  3 根据djid决定是INSERT还是UPDATE,如为INSERT,则从FC_MAXBH表中查找biaoshi字段为BIL的记录的recnum字段+1后
   	    当作djid,同时将+1后的值给recnum字段.
   	    
   	    更新FC_BILLZL表中的djid,djsn,dj_name,djlx,djposition,xmltext,designtext,stmptable
	此过程的输入参数：
		djid,djsn,dj_name,djlx,djposition,xmltext,designtext,stmptable   	    

 * 保存表单时，生成运行串要处理：1 数据集控件 2 页签控件 3 各控件的事件（点击） 4 生成建临时表的串
 
 
 * 分保存到数据库和保存到文件
 notalert = "不提示" 表示保存成功后不提示
 nothtml="是" 表示不生成正式表单文件
 iseb = "是" 表示用于e表中的保存参数报表,此时返回一个所需要的结果数组.

*@date 2004-07-21
**/
function DesignDjSave(notalert,nothtml,iseb){
	if(iseb != "是"){
	//存盘前检查
	if(isSpace(SKbillsheet.dj_sn)){
		var s1 = '表单sn不能为空!请进入表单属性窗口输入表单SN.'
		alert(s1) ;
		var arrForm=new Array();
		arrForm[0]=SKbillsheet;
		arrForm[5]=pstrUserFunction;
		s1 = DjOpen('form',arrForm,'展现',"有模式窗口","直接","表单属性") ;
		return s1
	}
	}
	//维护控件ID
	if(TooContXml()){ 
		openobjlist(); 
	}else{
		return "no empty";
	}
	//
	
		var d=new Date()
		var t = d.getTime();
	if(iseb != "是"){

		//保存 44,84,709,453,居中,不带工具栏,修改,当前窗口,有文件
		var sdjposition=""
		if(IsSpace(SKbillsheet.posleft)){
			sdjposition+=window.screenLeft+","
		}else{
			sdjposition+=SKbillsheet.posleft+","
		}
		if(IsSpace(SKbillsheet.postop)){
			sdjposition+=window.screenTop+","
		}else{
			sdjposition+=SKbillsheet.postop+","
		}
		if(IsSpace(SKbillsheet.poswidth)){
			sdjposition+=window.document.body.clientWidth+","
		}else{
			sdjposition+=SKbillsheet.poswidth+","
		}
		if(IsSpace(SKbillsheet.posheight)){
			sdjposition+=window.document.body.clientHeight+","
		}else{
			sdjposition+=SKbillsheet.posheight+","
		}
		sdjposition+=SKbillsheet.center+","
		sdjposition+=SKbillsheet.toolbar+","
		sdjposition+=SKbillsheet.entertype+","
		sdjposition+=SKbillsheet.window
	}
	var scontrolno=SaveControlNo()
	SKbillsheet.controlno=scontrolno
	//如和下一个ID
	
	//保存控件名称的DOM串
	SKbillsheet.contxml=oContXml.documentElement.xml
	
	DesignStr_RunStr_Before(SKbillsheet)
	
	var sDesignText = SKbillsheet.outerHTML ; //保存好设计串

	var sDesignTextBak = sDesignText ;


	
	//附加页面
	var tmpaddhtml=""
	if(pstrAddHtml != ""){
		tmpaddhtml=pstrSplitAddHtml+pstrAddHtml
	}
	if(iseb != "是"){

		//如果是保存到文件
		if (SKbillsheet.isfile == "是") {
			sDesignText="<![CDATA[<script>"+RepStr(pstrUserFunction,"\r\n","&#13;&#10;")+"</scr"+"ipt> "+sDesignText+tmpaddhtml+"]]>"
	//		var sFile = trim(SKbillsheet.type)+"_"+trim(SKbillsheet.dj_sn)
			var sFile = trim(SKbillsheet.dj_sn)
			var sXml = "<no>"+sFile+"</no><no>"+sDesignText+"</no><no></no>"+"<No>"+fcpubdata.Path+"</No>"
			var ret=savedesignhtml(sXml)
			if(ret == "") {
				if(notalert != "不提示") alert(sFile+".dj文件保存成功!") ;
				return "" ;
			}else{
				alert(ret)
				return ret
			}
			 
		}else{
			sDesignText="<![CDATA["+TransSql(sDesignText)+"]]>"
		
		}
	}
	
	SKbillsheet.removeAttribute("contentEditable")
	SKbillsheet.removeAttribute("unselectable")
	
	DesignStr_RunStr_Before0() ;
	//由设计转为运行串
	var sRun=SKbillsheet.outerHTML

	sRun = DesignStr_RunStr_After(sRun,ArrNum)
	if(iseb == "是"){ //e表保存 由此返回 
		return [sDesignTextBak,sRun,pstrUserFunction,pstrAddHtml];	
	}
	SKbillsheet.outerHTML = sDesignTextBak ;
    SKbillsheet.unselectable = "on";
    SKbillsheet.contentEditable=true

	//临时表	
	var stmptable=""
	if(isSpace(SKbillsheet.runsave)==false){
		stmptable=GetTmpTableStr() ;
		stmptable="<![CDATA["+TransSql(stmptable)+"]]>"
	}
	//自定义函数
	var tmpfunc=pstrUserFunction
	//tmpfunc=TransXml(tmpfunc) ;
	tmpfunc=TransSql(repNewLine(repXml(tmpfunc))) ;
	tmpaddhtml="<![CDATA["+TransSql(tmpaddhtml)+"]]>"
	
	sRun="<![CDATA["+TransSql(sRun)+"]]>"



	

	var sXml="<no>"+curdjid+"</no>"+"<no>"+SKbillsheet.dj_sn+"</no>"+"<no>"+SKbillsheet.caption+"</no>"+"<no>"+SKbillsheet.type+"</no>"
	         +"<no>"+sdjposition+"</no>"+"<no>"+sRun+"</no>"+"<no>"+sDesignText+"</no>"
	         +"<no>"+tmpfunc+"</no>"
	         +"<no>"+stmptable+"</no>"
			+"<no>"+tmpaddhtml+"</no>"
			+"<no>"+fcpubdata.databaseTypeName+"</no>"
			+"<no>"+SKbillsheet.version+"</no>";//为eform添加版本号
	//CopyToPub(sXml)
	var sRet=designdjsave(sXml);
	var iPos=sRet.indexOf(",")
	var sMsg=sRet.substring(iPos+1,sRet.length)

	
	if(isSpace(sMsg)==false){
		alert(sMsg)
		return sMsg
	}else{ // save ok
		if(curdjid == 0){
			var s=sRet.substring(0,iPos)
				
			curdjid=parseInt(s);
		}
		ChangeWinTitle(SKbillsheet.dj_sn)
		//起始页
		try{
			var arr=new Array(4);
			var str="";
			str=LoadPubData("origPage");
			arr=str.split(";");
			//var oXml=new ActiveXObject("Microsoft.XMLDOM");
			//oXml.async=false;
			// oXml.loadXML (str) ;
			var s1=curdjid+","+SKbillsheet.dj_sn+","+SKbillsheet.caption;
			arr=moveArr(arr,s1);
			var str1="";
			for(var i=0;i<arr.length;i++){
				str1+=arr[i]+";"
			}
			str1=str1.substring(0,str1.length-1);
			SavePubData("origPage",str1);
		}catch(e){}
		//生成正式表单文件
		if(nothtml != "是") {
			var tmpNo = SKbillsheet.dj_sn ;
			var obj = BillTypeNameToPath(SKbillsheet.type);
			
			var sPos=loadhtml("select djposition,dj_name from FC_BILLZL where djsn='"+tmpNo+"'",tmpNo,obj.path,obj.extname,function callback(){});
		}
		if(notalert != "不提示") alert("保存成功！")
		return ""
	}
	function moveArr(arr,sValue){
		if(sValue!=""){
			if(arr[0]!=sValue && arr[1]!=sValue && arr[2]!=sValue && arr[3]!=sValue){
				arr[3]=arr[2];
				arr[2]=arr[1];
				arr[1]=arr[0];
				arr[0]=sValue;
			}else{
				if(arr[0]==sValue || arr[1]==sValue || arr[2]==sValue || arr[3]==sValue){
					var str="";
					for(var i=3;i>=0;i--){
						if(arr[i]==sValue){
							str=arr[i];
							for(var j=i;j>0;j--){
								arr[j]=arr[j-1];
							}
							arr[0]=str;
							break;
						}
					}
				}
			}
		}
		return arr;
	}
	/**
	得到要建的临时表的建表串
	*@date 2004-07-30
	**/
	function GetTmpTableStr(){
		//return ""
		var sRet="";
		var oNode = oContXml.documentElement.selectSingleNode("dataset");
		if(oNode != null) {
			var l = oNode.childNodes.length;
			for(var i=0;i<l;i++){
				var id = oNode.childNodes(i).text;
				var ods=eval(id);
				if(ods.iscreatetable=="是"){
					var sXml=ods.formatxml;
					//西文字段名0 中文名称1 字段类型2 字段宽度3 字段精度4 
					var stablename=ods.temptable;
					sRet+=GetCreateTable(stablename,sXml,true)+";" ;
					
				}			
			}
		}	
		if(sRet != "" ){
			sRet=sRet.substring(0,sRet.length-1);
		}
		return sRet;
		

	}
	
}
/**
打开表单
designtext字段中包含自定义函数的内容，但不含附加页面的内容。
自定义函数的内容在最前面。
*@date 2004-08-02
**/

function DesignDjOpen(djid){
	if(SaveTip() == true) return;
	if (djid<=0) return ""
    if(fcpubdata.databaseTypeName == "oracle"){
    	var sRet = loadClob("<no>designtext</no><no>"+djid+"</no>")
		//sRet = UnTransSql(sRet)   	
    }else{
	    
		var sql="select designtext from FC_BILLZL where djid="+djid ;
		var sRet=SqlToField(sql);
		if(isSpace(sRet)) return ""
	}
	var s = DesignDjOpenSub(sRet,djid);
	return s
}
function DesignDjOpenSub(sRet,djid) {
	//CopyToPub(sRet)
	//自定义函数+"</scr"+"ipt>"+表单画的内容+pstrSplitAddHtml+附加表单的内容
	if(typeof djid == "undefined") djid = 0
	if(typeof sRet == "object"){ //e表时用
		if(IsSpace(sRet[0]) == false){
			SKbillsheet.outerHTML=sRet[0];
		}
		//sRet[1] 为表单运行串
		pstrUserFunction = sRet[2];
		pstrAddHtml = sRet[3]
		
	}else{
		var iEnd=sRet.indexOf("</scr"+"ipt>") ;
		if(iEnd==-1){
			pstrUserFunction="";
			sHtm=sRet
		}else{
			var sHtm=sRet.substring(iEnd+9,sRet.length) ;
			if(isSpace(sHtm)){
				
				return ""
			} 
			pstrUserFunction=sRet.substring(8,iEnd) ;
			pstrUserFunction=unRepNewLine(unRepXml(pstrUserFunction));
		}
		//求 附加页面串
		var ipos=sHtm.indexOf(pstrSplitAddHtml)
		if(ipos==-1){
			pstrAddHtml=""
			
		}else{
			pstrAddHtml=sHtm.substring(ipos+pstrSplitAddHtml.length,sHtm.length)	
			sHtm=sHtm.substring(0,ipos)
		}
		SKbillsheet.outerHTML=sHtm //+pstrAddHtml ;
		//alert(SKbillsheet);
	}
	try{
		if(isSpace(SKbillsheet.controlno)) return "" ;
	}catch(e){
		//当sHtm不是合法的HTM串时出错
		if(isSpace(sHtm) == false){
			alert(sHtm);
		}
		return "" ;
	}
	curdjid=djid ;

	ArrNum = OpenControlNo(SKbillsheet.controlno,ArrNum)
	var scontxml = SKbillsheet.contxml
	if(isSpace(scontxml)  ) {
		scontxml = "<root></root>"
	}
	oContXml=SetDom(scontxml)
	
	//处理控件列表
	openobjlist();
	ShowAllField();
	
	pageonload()
	ChangeWinTitle(SKbillsheet.dj_sn)
	bigmain.focus() ;
	//CopyToPub(bigmain.innerHTML)
	blnChange = false
	return "OK"
}

/**
新建表单,isWizard ="是" 表示有向导
*@date 2004-08-02
**/
function DesignDjNew(isWizard) {
	if(SaveTip() == true) return;
	if(isWizard == "是"){
		var sHtm = DjOpen('fcs_NewWizard',SKbillsheet,'展现',"有模式窗口","直接","新建表单向导");
		if(typeof sHtm == "undefined") return ;
	}else{
		var sHtm = "空" ;
	}
	if( sHtm == "空") {
		curdjid=0 ;
		pstrUserFunction=""
		pstrAddHtml=""
		SKbillsheet.outerHTML ='<div id="SKbillsheet" oncontrolselect="controlselect()" jslib="fcsavedj.js&#13;&#10;fcbasecont.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" ></div>'
		//SKbillsheet.unselectable = "on";
		SKbillsheet.contentEditable=true

		//pubDsMain.outerHTML ='<img id="pubDsMain" dsid="DsMain" style="display:none">'
		InitControlNo()
		oContXml = SetDom("<root></root>")
		AutoAddDsMain();		
		ChangeWinTitle("表单设计工具")
		try {
			bigmain.focus() ;
		//	SKbillsheet.focus();
		}catch(e){}
	}else{
	//if( sHtm != "空"){
		SKbillsheet.innerHTML=sHtm;
		//CopyToPub(sHtm)
	}
	if(TooContXml()){openobjlist();ShowAllField();}
	
	if(IsSpace(sHtm) == false && sHtm != "空") 
		blnChange = true;
	else
		blnChange = false;
	
}
/**
表单另存
*@date 2004-08-04
**/
function DesignDjSaveAs(){
	var sRet=window.showModalDialog("input.htm","","status:no;dialogHeight:120px;dialogWidth:400px;dialogTop:180;dialogLeft:250px") 
	if(typeof sRet=="undefined") return
	SKbillsheet.dj_sn=sRet
	curdjid=0;
	DesignDjSave()	
	ChangeWinTitle(SKbillsheet.dj_sn)
}
/**
存盘前提示
*@date 2004-08-05
**/
function SaveTip(){
	if(blnChange == false) return 
	var ret = window.confirm("确定保存当前表单吗？");		
	if (ret == true) {
		DesignDjSave();
	}

	return ret;
}

/**
保存找到当前表单中控件的号码
*@date 2004-08-04
**/
function SaveControlNo() {
//ArrNum['SKButton']++
	var sRet=""
	for(var Num=0;Num<ArrName.length;Num++){
		sRet+=ArrName[Num]+":"+ArrNum[ArrName[Num]]+";" ;
//		sRet+=ArrNum[ArrName[Num]]+";" ;
	}
	sRet=sRet.substring(0,sRet.length-1);
	return sRet ;
}

function window_onbeforeunload() {
	
	if(blnChange == false) return 
	event.returnValue="离开当前页面将导致当前输入的数据丢失!"
}

function main_onbeforeeditfocus() {
	var obj = event.srcElement ;
	if(obj.tagName == "TD" ||obj.id =="SKbillsheet" ) return ;
	event.returnValue = false
}
function main_exec(scomm) {
	document.execCommand(scomm)

}
function window_onresize() {
	var iwidth =document.body.offsetWidth - 2
	var iheight =document.body.offsetHeight - 2
	if(iwidth<0) iwidth=100;
	if(iheight<0) iheight=100;
	srcHtml.style.width = iwidth
	srcHtml.style.height = iheight
	//如设置了窗口宽度,则始终是设置的宽度值,否则为窗口的宽度
	var iwidth1 = parseInt(SKbillsheet.poswidth)
	if(isSpace(SKbillsheet.poswidth) == false ){
		//if(bigmain.offsetWidth < iwidth1 ){
			bigmain.style.width = iwidth1
		//}
	}else{
		bigmain.style.width = iwidth
	}
	var iheight1 = parseInt(SKbillsheet.posheight)
	if(isSpace(SKbillsheet.posheight) == false ){
		//if(bigmain.offsetHeight < iheight1 ){
			bigmain.style.height = iheight1
		//}
	}else{
		bigmain.style.height = iheight
	}
	//middlediv.style.width = bigmain.style.width
	//middlediv.style.height = bigmain.style.height
}
/**
删除ocontxml中值相同的节点
*@date 2005-03-30
**/
function DelSameNameNode() {
	var curid = ""
	var l=oContXml.documentElement.childNodes.length
	for(var i=0;i<l;i++){
		var l1 = oContXml.documentElement.childNodes(i).childNodes.length
		for(var j=l1-1;j>=0;j--){
			if(curid == oContXml.documentElement.childNodes(i).childNodes(j).text) {
				oContXml.documentElement.childNodes(i).removeChild(oContXml.documentElement.childNodes(i).childNodes(j))
				continue
			}
			curid = oContXml.documentElement.childNodes(i).childNodes(j).text ;
		}
	}
}

/**
* 由界面上的控件 ==> oContXml 
*@return false 表示id重复,没有做同步工作,
*@date 2005-04-19
**/
function TooContXml() {
	var sRet = "<root>"
	var arrXml = new Array()
	var o = SKbillsheet.all
	var l=o.length ;
	for(var i=0;i<l;i++){
		var sid = o[i].id
		var scontroltype = o[i].controltype
		if(typeof(sid) == "undefined" ) continue
		//如没有controltype,表示是旧的控件,则要补上,2006-01-23 remove
		/*
		if(typeof(scontroltype) == "undefined") {
			var ll=ArrName.length;
			for (var ii=0;ii<ll;ii++){
				if (sid.indexOf(ArrName[ii])==0){
					o[i].controltype = ArrName[ii] ;
					scontroltype = o[i].controltype ;
					break ;
				}
			}
			
		}*/
		
		if(typeof arrXml[scontroltype] == "undefined") arrXml[scontroltype] =""
		var tmp = "<id>"+ sid +"</id>" ;
		if(arrXml[scontroltype].indexOf(tmp) >= 0  && sid != "" && sid != "fcpagesub" && sid != "fcpagesubtable" ){
			alert("注意: "+sid+"重复!请修改." )
			return false ;
		}else if(sid == "" || sid == "fcpagesub" || sid == "fcpagesubtable"){
			
		}else{
			arrXml[scontroltype] += tmp ;
		}
		
	}
	var l = ArrName.length ;
	for(var i=0;i<l;i++){
		if(isSpace(arrXml[ArrName[i]]) == false){
			sRet += "<"+ ArrName[i] +">" + arrXml[ArrName[i]]+"</"+ ArrName[i] +">"
			
		}
	}
	
	sRet += "</root>"
	
	
	oContXml = SetDom(sRet) ;
	//计算新的tab串
	//SKbillsheet.billtaborder = "" ; //清空以重算
	SKbillsheet.billtaborder = TaborderXml() ;
	return true
}	
/**
* 在设计窗口点右键菜单的调用
*@date 2005-08-11
**/
function main_onRightClick() {
	var tagName = event.srcElement.tagName ;
	
	if(tagName == "TD"){
		//RightMenu.DataSource="MenuTab.value" ;
		RightMenuTab.showMenu(window,RightMenuTab.dataSource.documentElement.selectSingleNode('//MenuItem'),window.document.body,event.x,event.y) ;
	}else{
		//RightMenu.DataSource="MenuCode.value" ;
		RightMenu.showMenu(window,RightMenu.dataSource.documentElement.selectSingleNode('//MenuItem'),window.document.body,event.x,event.y) ;
	}
		//RightMenu.Init() ;
		

}
/**
*设置TD上选中的文本的属性
*@date 2005-08-22
**/
function SetSelTextProp() {
	var sRet=DjOpen('fcs_selprop',window,'展现','无模式窗口','直接','设置当前选中文本的属性');
}
/*
function bill_ondrop() {
	event.returnValue = false
	//alert(event.srcElement.outerHTML)
	//var s1 = event.dataTransfer.getData("Text") ;
	
}*/

function mytest(){
	var oControlRange = document.body.createControlRange();
	//oControlRange.add(SKbillsheet);
	oControlRange.select();

//	event.returnValue =false
//	test1.value=SaveControlNo()
}
function mytest1(){
	//OpenControlNo(test1.value)
	htmltocont('<button controltype="FCButton" id="FCButton1" >aa</button>','FCButton')
}

//20081024新增，设置只读权限参数，增加对部分控件设置只读样式的功能
function setReadOnlyParameter(obj)
{
	var arr=new Array();
	
	if(typeof obj == "undefined")
	{
		try {var obj=event.srcElement;}catch(e){obj=curSelElement;}
	}
	else
	{
		try {parent.topic.focus();}catch(e) {}
	}
	if(obj == null) {return;}
	if(typeof obj.tagName=="undefined"){obj=curSelElement;}
	var strid=obj.id;
	if(isSpace(strid))
	{
		try 
		{
			var stmp1 = obj.parentNode.divtype;
			if( stmp1 =="checkbox")
			{
				obj=obj.parentNode;
				strid=obj.id;
			}
		} catch(e) {}
	}
	
	if(obj.controltype=="text"||obj.controltype == "textarea"||obj.controltype=="combobox") //对于这三种控件可以设置只读样式
	{
		arr[0] = parent.topdjid + strid;
    	arr[1] = parent.topdjid;
    	arr[2] = parent.oid;
    	DjOpen('setReadOnlyParameter',arr,'新增','有模式窗口','直接','设置只读权限');
	}
	else
  	{
  		setAuthorization(-2);      //直接调用方法设置只读权限
   	}
   	return;	
}

//20080328新增，选作控制参数
function setControlParameter(obj){
	
	var arr=new Array();
	
	if(typeof obj == "undefined"){
		try {
			var obj=event.srcElement;
		}catch(e){
			obj=curSelElement;
		}
	}else{
		try {
			parent.topic.focus();
		}catch(e) {}
	}
	
	if(obj == null) {
		//Addobj('form');
		return;
	}

	if(typeof obj.tagName=="undefined"){
		obj=curSelElement;
	}
	
	var strid=obj.id;

	if(isSpace(strid)){
		try {
			var stmp1 = obj.parentNode.divtype;
			if( stmp1 =="checkbox"){
				obj=obj.parentNode;
				strid=obj.id;
			}
		} catch(e) {}
	}
	
    if(obj.controltype == "text" || obj.controltype == "checkbox" || obj.controltype == "radio" || obj.controltype == "checkboxlist"
       || obj.controltype == "radiolist" || obj.controltype == "spin" || obj.controltype == "listbox" 
            || obj.controltype == "dropdownlist" || obj.controltype == "combobox" || obj.controltype == "textarea"){
    	//alert(strid);
    	//alert(obj.controltype);
    	//alert(SKbillsheet.dj_sn);    	  	
    	arr[0] = "F_"+parent.topdjid + strid;
    	arr[1] = parent.topdjid;
    	arr[2] = parent.workflowid;
    	DjOpen('setControlParameter',arr,'新增','有模式窗口','直接','设置控制参数');
    }else{
    	alert("该控件的值不能作为控制参数！");
    }
	return;	
}

//20080328新增，用来设置元素的权限
//num: -2,只读；-1,weboffice权限控制；0,正常；1,disable;2,不可见
function setAuthorization(num,obj){
	var noArray = ['chart','dbimg','grid','dataset','a','shape','img']; //不能做权限控制的控件,外加一个table
	var hiddenArray = ['tree','radiolist','checkboxlist','div','label','spin','tab']; //只能做隐藏权限的控件
	var disableHiddenArray = ['dropdownlist','listbox','radio','button','checkbox']; //可以做disable，不可见的控件
	var allArray = ['textarea','text','combobox']; //可以做“只读，disable，不可见”的权限控制的控件
	var otherArray = ['workflowControl','WebOffice','gaEditor','upload']; //不在这里做权限控制的控件
	
	var i = 0;
	if(typeof obj == "undefined"){
		try {
			var obj=event.srcElement;		
		}catch(e){
			obj=curSelElement;			
		}
	}else{
		try {
			parent.topic.focus();			
		}catch(e) {}
	}
	if(obj == null) {
		//Addobj('form');
		return;
	}
	if(typeof obj.tagName=="undefined"){
		obj=curSelElement;		
	}
	
	var strid=obj.id;

	if(isSpace(strid)){
		try {
			var stmp1 = obj.parentNode.divtype;
			if( stmp1 =="checkbox"){
				obj=obj.parentNode;
				strid=obj.id;
			}
		} catch(e) {}
	}
	//不能做权限控制的控件：
	if(obj.tagName=='TABLE' || obj.tagName=='table'){
		alert("该控件不能进行权限控制。");
	    return;
	}
	//if(obj.controltype=='dbimg' || obj.controltype=='dataset' ||obj.controltype=='chart' || obj.controltype=='upload' || obj.tagName=='TABLE'){
	for(i = 0;i < noArray.length;i++){
	    if(obj.controltype == noArray[i]){
	    	alert("该控件不能进行权限控制。");
	    	return;
	    }
	}
	for(i = 0;i < otherArray.length;i++){
		if(obj.controltype!='WebOffice' && obj.controltype == otherArray[i]){
			alert("该控件不能进行权限控制。");
			return;
		}
	}
	//只能做隐藏的控件：
	//if(obj.controltype=='img' || obj.controltype=='shape' || obj.controltype=='spin' || obj.controltype=='tree'
	//     || obj.controltype=='dropdownlist'){
	for(i = 0; i < hiddenArray.length;i++){
	    if(obj.controltype==hiddenArray[i]){
	    	if(num==1 || num==-2){
	        	alert("该控件只能做\"不可见\"的权限控制。");
	        	return;
	    	}
	    }     
	}
	
	//只能做disable和不可见的控件
	for(i = 0; i < disableHiddenArray.length;i++){
	    if(obj.controltype==disableHiddenArray[i]){
	    	if(num == -2){
	    		alert("该控件不能做\"只读\"的权限控制");
	    		return;
	    	}
	    }
	}
	
	//如果不是office控件就不能进行此操作。
	if(obj.controltype!='WebOffice' && num==-1){
		alert("该控件不能进行此操作！");
		return;
	}
	
	var djid = parent.topdjid;  
    var ctrl_id = djid+strid;
    var oid = parent.oid;
    
    var myPara = new Array();
    myPara[0] = ctrl_id;
    myPara[1] = oid;
    
	//判断是否为office控件：
	if(obj.controltype=='WebOffice'){
	    if(num==-1){	    	
	    	var myNum = window.showModalDialog("setWebOfficeStatus.jsp",myPara);	  	    
	    	if(myNum=="undefined" || myNum == null){
	    		//alert("取消");
	    		return;
	    	}else{
	        	//alert("赋值");
	    		num = myNum; //myNum的取值：3：只读；4：允许修改，保留痕迹；5：领导手写批注；6：成文员文档核稿；7：允许修改，保留痕迹，可修订;8:允许修改，无痕迹；9：文档核稿(带套红)；10:清稿有痕迹
	    	}
	    	//alert("num:"+num);
	    }else{
	    	alert("该控件不能执行此操作！");
	    	return;
	    }
	}
	
    var authority = num;
    
    //alert("djid: "+djid);
    //alert("oid: "+oid);
    //alert("ctrl_id: "+ctrl_id);
    //alert("authority: "+authority);
    
    var selectSql = "select perattr_type from TD_FORM_PERATTR where ctrl_id='"+ctrl_id+"' and oid ='"+oid+"'";
    var isExist = SelectSql(selectSql,1,5);
    if(isExist=="<root></root>"){
        var uuid = creator_getUUID();
        var insertSql = "insert into TD_FORM_PERATTR(PERATTR_ID,djid,oid,ctrl_id,perattr_type) values('"+uuid+"',"+djid+",'"+oid+"','"+ctrl_id+"',"+authority+")";
        var result = creator_insert(insertSql);
        if(IsSpace(result)){
            alert("保存成功！");
        }else{
            alert("保存失败！");
            alert(result);
        }   
    }else{
        var old_authority = isExist.substring(isExist.indexOf("<fc>")+4,isExist.indexOf("</fc>"));               
        old_authority = getControlAuthority(old_authority);
        var current_authority = getControlAuthority(authority);
        if(confirm('该元素已经设置为"'+old_authority+'",您确定要重新设置为"'+current_authority+'"？')){
            var updateSql = "update td_form_perattr set perattr_type="+authority+" where ctrl_id = '"+ctrl_id+"' and oid='"+oid+"'";
            var result = creator_update(updateSql);
            if(IsSpace(result)){
                alert("保存成功！");
            }else{
                alert("保存失败！");
                alert(result);
            }
        }
    }
}

	function getControlAuthority(authority){	    
	    authority = authority - 0;
	    switch(authority){
	        case -2:authority = "只读元素";break;
        	case 0: authority = "可见(默认)";break;
        	case 1: authority = "disabled";break;
        	case 2: authority = "不可见";break;
        	case 3: authority = "只读";break;
        	case 4: authority = "允许修改，保留痕迹";break;
        	case 5: authority = "领导手写批注";break;
        	case 6: authority = "成文员文档核稿";break;
        	case 7: authority = "允许修改，保留痕迹，可修订";break;
        	case 8: authority = "允许修改，无痕迹";break;
        	case 9: authority = "成文员文档核稿(带套红)";break;
        	case 10:authority = "清稿有痕迹";break;
        	case 11:authority = "文档核稿（只读）";break;
        	default: authority = "是否为新的权限？";
        }
        return authority;
	}
	
	//作用：退出iWebOffice
	function UnLoadWebOffice(){    				
		var iWebOffice = document.getElementsByName("WebOffice")[0];  //获取控件对象。 				
		if(iWebOffice!=null && iWebOffice!="undefined"){ 										
			iWebOffice.WebClose();									
		}
	}

//-->.
		</SCRIPT>
	</HEAD>
	<BODY onbeforeunload="window_onbeforeunload()" onload="window_onload()" id="mainbody"
	onresize="window_onresize()" onunload="UnLoadWebOffice()"
		>
		<!--<input type="button" value="test" onclick="mytest()"><input id=test1 >
		<input type="button" value="test1" onclick="mytest1()" >
				<button onclick="document.execCommand('Delete')">test</button>
			<table border=1 style="table-layout:fixed;position:absolute">
				<colgroup><col style="width:60"><col style="width:160"><col style="width:100"></colgroup>
				<tr><td>aa</td><td>遗传2基因</td><td>遗传2基因ss</td></tr>
				<tr><td>aa</td><td><input id=test1 NAME="test1"></td><td>遗传1基因ss</td></tr>
				<tr><td>aa</td><td>遗传基因</td><td>遗传基因ss</td></tr>
			</table>
<button ID="Button1">设计</button><button ID="Button2">HTML</button>
		-->
		
		<div id="bigmain" onbeforeeditfocus="main_onbeforeeditfocus()"
		onclick="window_onclick()" onkeydown="main_onkeydown()"
		onkeyup="main_onkeyup()" oncontextmenu="main_onRightClick()"
		
		
		>
		<div id="middlediv" style="overflow:auto;"  >
			<div id="SKbillsheet" oncontrolselect="controlselect()" jslib="fcsavedj.js&#13;&#10;fcbasecont.js&#13;&#10;selectdate.js&#13;&#10;~userfunc.js" >
			</div>
		</div>
		</div>
		
		<textarea rows="17" id="srcHtml" cols="73" style="display:none" >
		</textarea>
		
		<WebMenu DataSource="MenuCode.value" class="WebMenu" id="RightMenu" Width="100" Effect="3" MenuType="1" ></WebMenu>
		<textarea rows="17" id="MenuCode" cols="73" style="display:none" NAME="MenuCode">
				
				<Root>
					<MenuItem  hasSub="1" subWidth="160" >							
							<MenuItem Func="javascript:setControlParameter();" Text="选作控制参数" img="../images/ef_tab_cell_prop.gif"/>
							<MenuItem Func='javascript:setAuthorization(-1);' Text="设置office控件的状态" img="../images/ef_tab_cell_prop.gif"/>
							<MenuItem Func="javascript:setAuthorization(1);" Text="设置为disable" img="../images/ef_tab_cell_prop.gif"/>
					        <MenuItem Func="javascript:setAuthorization(2);" Text="设置为不可见" img="../images/ef_tab_cell_prop.gif"/>
					        <MenuItem Func="javascript:setReadOnlyParameter();" Text="设置为只读" img="../images/ef_tab_cell_prop.gif"/>
					        <MenuItem Func="javascript:setAuthorization(0);" Text="enable(默认)" img="../images/ef_tab_cell_prop.gif"/>
					</MenuItem>
				</Root>

		</textarea>
		<WebMenu DataSource="MenuTab.value" class="WebMenu" id="RightMenuTab" Width="100" Effect="3" MenuType="1" ></WebMenu>
		<textarea rows="17" id="MenuTab" cols="73" style="display:none" >
				<Root>
					<MenuItem  hasSub="1" subWidth="160" >
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-table-prop');" Text="表格属性" hasLine="1" img="../images/ef_tab_table_prop.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-row-insert-above');" Text="在前面加一行" img="../images/ef_tab_row_insert_above.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-row-insert-under');" Text="在后面加一行" img="../images/ef_tab_row_insert_under.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-row-delete');" Text="删除当前行" img="../images/ef_tab_row_delete.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-row-split');" Text="按行拆分单元格" hasLine="1" img="../images/ef_tab_row_split.gif" />
							  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-col-insert-before');" Text="在前面加一列" img="../images/ef_tab_col_insert_before.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-col-insert-after');" Text="在后面加一列" img="../images/ef_tab_col_insert_after.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-col-delete');" Text="删除当前列" img="../images/ef_tab_col_delete.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-col-split');" Text="按列拆分单元格" hasLine="1" img="../images/ef_tab_col_split.gif" />

							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-cell-prop');" Text="单元格属性" hasLine="1" img="../images/ef_tab_cell_prop.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-cell-insert-before');" Text="在前面加单元格" img="../images/ef_tab_cell_insert_before.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-cell-insert-after');" Text="在后面加单元格" img="../images/ef_tab_cell_insert_after.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-cell-delete');" Text="删除当前单元格" img="../images/ef_tab_cell_delete.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-cell-merge');" Text="合并单元格" img="../images/ef_tab_cell_merge.gif" />  
							<MenuItem Func="javascript:editortab.buttonPress(editor,'TO-cell-split');" Text="拆分单元格" hasLine="1" img="../images/ef_tab_cell_split.gif" />  
							
							<MenuItem Func="javascript:SetSelTextProp();" Text="选中文本属性" img="../images/ef_tab_cell_prop.gif" />  

					</MenuItem>
				</Root>

		</textarea>	
		
	</BODY>
</HTML>
