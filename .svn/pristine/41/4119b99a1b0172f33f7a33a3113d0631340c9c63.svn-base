<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns:fc xmlns:v="urn:schemas-microsoft-com:vml">
	<HEAD>
		<STYLE> .userData{behavior:url(#default#userData);}
	@import url(../css/dj.css); 
	</STYLE>
		<script src="../js/fcpub.js"></script>
		<script src="../js/fcrundj.js"></script>
		<script src="../js/tabpane.js"></script>		
	</HEAD>
	<body background="../images/ef_run_background.gif" onload="pub_window_onload()"
		onkeydown="RunTabindex()" onbeforeunload="pub_window_onbeforeunload()" onkeypress="pub_window_onkeypress()"
		onresize="pub_window_onresize()">
		<script>
var pubdjbh=parent.sOpenDjNo;
var pubEdit=false;   			
var pubDataSet=null;
var pubRequest=parent.oRequest;
var pubEformEnterStatus="OK"; 
pub_djhtm();
		</script>
<script>var obj ;
function uf_open(){
	//CopyToPub(dataset1.xml);
	//CopyToPub(grid2.format);
	//return;
	
	var sds = pubDataSet[0] ; 
	if(IsSpace(sds) == false){
		dataset1.OpenXmlData(unescape(sds));
	}else{
		dataset1.Delete();
	}	
	var sds = pubDataSet[1] ;

	if(IsSpace(sds) == false){
		grid2.format=uf_getGridFormat(dataset1.RecordCount);
		dataset2.OpenXmlData(unescape(sds));
	}else{
		dataset2.Delete();
	}	
	e_PropWinOnload();		
}

function uf_ok() {
	/*
	grid1.hide();
	dataset1.cont_onDataChange();
	if(dataset1.Update()==1) return;  //如未离开当前行则要强行更新.	
	grid2.hide();
	dataset2.cont_onDataChange();
	if(dataset2.Update()==1) return;  //如未离开当前行则要强行更新.	
	*/
	window.returnValue = [escape(dataset1.xml),escape(dataset2.xml)];
	CloseBill();
	
}
function uf_delfield() {
	if(dataset1.RecordCount<=0) {
		alert("没有要删除的字段!");
		return;
	}	
	if(window.confirm("删除 "+dataset1.Fields.Field['fieldname'].Value+" 字段的同时会将此字段的所有记录数据都删除,你确定要删除吗?")==false) return;
	
	var sAll="";
	if(dataset1.RecordCount==1){
		sAll = "<root><tr><td></td></tr><set><pages>0</pages><fields><field><fieldname>aaaa</fieldname><datatype>字符</datatype><displaylabel>新建字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>";
	}else{
		var oField = dataset2.oDom.documentElement.childNodes(dataset2.oDom.documentElement.childNodes.length-1).childNodes(1)	;
		oField.removeChild(oField.childNodes(dataset1.RecNo));
		var l = dataset2.oDom.documentElement.childNodes.length-1;
		for(var i=0;i<l;i++){
			dataset2.oDom.documentElement.childNodes(i).removeChild(dataset2.oDom.documentElement.childNodes(i).childNodes(dataset1.RecNo));	
		}
		sAll = dataset2.oDom.documentElement.xml ;
	}
	
	dataset2.OpenXmlData(sAll);	
	
	dataset1.Delete();
}
function uf_addfield() {
	var sAll="";
	if(dataset1.RecordCount==0){
		dataset1.Append();
		dataset1.fset_cont();
		//<root><tr rowstate="add"><td></td></tr><set><pages>0</pages><fields><field><fieldname>aaaa</fieldname><datatype>字符</datatype><displaylabel>新建字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>
		sAll="<root><tr><td></td></tr><set><pages>0</pages><fields><field><fieldname>"+dataset1.Fields.Field['fieldname'].Value+"</fieldname><datatype>字符</datatype><displaylabel>"+dataset1.Fields.Field['fieldname'].Value+"</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields></set></root>";
	}else{
		dataset1.Append();
		dataset1.fset_cont();
		var oField = dataset2.oDom.documentElement.childNodes(dataset2.oDom.documentElement.childNodes.length-1).childNodes(1)	;
		var oSub = SetDom("<field><fieldname>"+dataset1.Fields.Field['fieldname'].Value+"</fieldname><datatype>字符</datatype><displaylabel>"+dataset1.Fields.Field['fieldname'].Value+"</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field>");
		oField.appendChild(oSub.documentElement);
		var l = dataset2.oDom.documentElement.childNodes.length-1;
		for(var i=0;i<l;i++){
			var oSub1=SetDom("<td/>");
			dataset2.oDom.documentElement.childNodes(i).appendChild(oSub1.documentElement);	
		}
		sAll = dataset2.oDom.documentElement.xml ;
		/*
		l=dataset1.RecordCount;
		var sb=new StringBuilder();
		for(var i=0;i<l;i++){
			sb.append("<col><fname>aaaa</fname><cname>新建字段</cname><width>10</width><dtype>字符</dtype><readonly>否</readonly><visible>是</visible><u></u><v></v><s></s><r></r><columnwidth>80</columnwidth><align>left</align></col>");
		}
		grid2.format="<cols>"+sb.toString()+"</cols>";
		*/
		grid2.format=uf_getGridFormat(dataset1.RecordCount);
	}	
	dataset2.OpenXmlData(sAll);
	
}
function uf_getGridFormat(iCount){
	var l=iCount;
	var sb=new StringBuilder();
	for(var i=0;i<l;i++){
		sb.append("<col><fname>aaaa</fname><cname>新建字段</cname><width>10</width><dtype>字符</dtype><readonly>否</readonly><visible>是</visible><u></u><v></v><s></s><r></r><columnwidth>80</columnwidth><align>left</align></col>");
	}
	return "<cols>"+sb.toString()+"</cols>";
	
}
function uf_afterupdate() {
	//更新标题
	var index = dataset1.RecNo;
	var newTitle=dataset1.Fields.Field["fieldname"].Value;
	var oField = dataset2.oDom.documentElement.childNodes(dataset2.oDom.documentElement.childNodes.length-1).childNodes(1)	;
	oField.childNodes(index).childNodes(0).text=newTitle;
	oField.childNodes(index).childNodes(2).text=newTitle;	
	grid2.tab.rows(0).cells(index+1).innerText = newTitle;
}
//页签控件的点击事件
function PubClickPageControl(index) {
	var oGrid = grid1;
	if(index == 1){
		oGrid = grid2;
	}
	oGrid.ParentPos = "相对" ;
	oGrid.hideVscroll = false ;
	oGrid.hideHscroll = false ;
	oGrid.HScroll();  //重算滚动条
	oGrid.VScroll();
}

</script><script src='../js/fcopendj.js'></script><script defer src='../js/fcsavedj.js'></script><script src='../js/fcselfuse.js'></script><script src='../js/fcbasecont.js'></script><script defer src='../js/fcother.js'></script><script defer src='../js/selectdate.js'></script><script src='../js/fcdate.js'></script><script src='../../fceformext/js/userfunc.js'></script><link href=../css/tabstyle.css type=text/css rel=stylesheet><script src='../js/webfxlayout.js'></script><link id='luna-tab-style-sheet' type='text/css' rel='stylesheet' href='../css/luna/tab.css'  /><link type='text/css' rel='stylesheet' href='../css/Button.css'/><script >document.styleSheets[0].addRule("fc\\:webgrid","behavior: url(../htc/webgrid.htc)",0);</script><script src='../js/fcwebgrid.js'></script><script >document.styleSheets[0].addRule("fc\\:fc_code","behavior: url(../htc/fc_code.htc)",0);</script><script >document.styleSheets[0].addRule("fc\\:dataset","behavior: url(../htc/dataset.htc)",0);</script><script src='../js/fcdataset.js'></script>
<DIV id=SKbillsheet jslib="fcopendj.js&#13;&#10;fcsavedj.js&#13;&#10;fcselfuse.js&#13;&#10;fcbasecont.js&#13;&#10;fcother.js&#13;&#10;selectdate.js&#13;&#10;fcdate.js&#13;&#10;~userfunc.js" BLONopen="uf_open()" center="居中" contxml="<root><tab><id>tab2</id></tab><button><id>cmdAdd1</id><id>cmdDel1</id><id>cmdAdd</id><id>cmdDel</id><id>cmdOk</id><id>cmdClose</id></button><grid><id>grid1</id><id>grid2</id></grid><dataset><id>dataset1</id><id>dataset2</id></dataset></root>" billtaborder="<root><taborder>grid1</taborder><taborder>grid2</taborder><taborder>cmdAdd1</taborder><taborder>cmdDel1</taborder><taborder>cmdOk</taborder><taborder>cmdClose</taborder><taborder>cmdAdd</taborder><taborder>cmdDel</taborder></root>" dj_sn="eb_dataset2" type="PR" caption="编辑内置数据集" mkbh codeheader="BBB" entertype="修改" poswidth="540" posheight="400" controlno="SKButton:0;SKDBedit:0;checkbox:0;label:0;radio:0;listbox:0;textarea:0;combobox:0;password:0;upload:0;SKDBtext:0;chart:0;dbimg:0;img:0;SKBILLgrid:0;shape:0;tab:2;div:0;DsMain_field:0;a:0;button:7;text:0;hr:0;checkboxlist:0;radiolist:0;dropdownlist:0;grid:2;dataset:2;spin:0;excel:0;tree:0" keyfield window="有模式窗口" posleft postop isfile="否" idtype="1" toolbar="不带工具栏" OtherSave="否"><?xml:namespace prefix = fc /><fc:dataset id=dataset1 AfterPost='bill_dsevent("AfterPost","uf_afterupdate()")' temptable="TMP_DATASET1" opensortno="1" format="<fields><field><fieldname>fieldname</fieldname><datatype>字符</datatype><displaylabel>字段名</displaylabel><size>50</size><precision>0</precision><fieldkind>变量默认值</fieldkind><defaultvalue>'字段'+(mRecordCount+1)</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field><field><fieldname>datatype</fieldname><datatype>字符</datatype><displaylabel>数据类型</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue>字符串</defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields>" onValid='bill_ondatasetvalid("<dsid><fieldname></fieldname><datatype></datatype></dsid>")' onGetText='bill_ondatasetgettext("<dsid><fieldname></fieldname><datatype></datatype></dsid>")' onSetText='bill_ondatasetsettext("<dsid><fieldname></fieldname><datatype></datatype></dsid>")'></fc:dataset>&nbsp; 
<DIV class=tab-pane id=tab2 style="LEFT: 4px; WIDTH: 518px; POSITION: absolute; TOP: 0px; HEIGHT: 339px" IsHideTitle="undefined" showtype="luna">
<DIV class=tab-page style="WIDTH: 518px; HEIGHT: 321px">
<H2 class=tab>字段</H2><fc:webgrid id=grid1 onkeydown='bill_ongridkeydown("<grid1><col></col><col></col></grid1>")' ondblclick='bill_ongriddblclick("<grid1><col></col><col></col></grid1>")' onclick='bill_ongridclick("<grid1><col></col><col></col></grid1>")' ParentPos="相对" visible="是" readonly="否" autoappend="否" autowidth="否" autoheight="否" canselect="是" dataset="dataset1" format="<cols><col><fname>fieldname</fname><cname>字段名</cname><width>50</width><dtype>字符</dtype><readonly>否</readonly><visible>是</visible><u></u><v></v><s></s><r></r><columnwidth>180</columnwidth><align>left</align></col><col><fname>datatype</fname><cname>数据类型</cname><width>10</width><dtype>字符</dtype><readonly>选%3Ccode%3E%3Cxml%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u6574%u6570%3C/td%3E%3Ctd%3E%u6574%u6570%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B9E%u6570%3C/td%3E%3Ctd%3E%u5B9E%u6570%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B57%u7B26%u4E32%3C/td%3E%3Ctd%3E%u5B57%u7B26%u4E32%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u65E5%u671F%3C/td%3E%3Ctd%3E%u65E5%u671F%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u65F6%u95F4%3C/td%3E%3Ctd%3E%u65F6%u95F4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u65E5%u671F%u65F6%u95F4%3C/td%3E%3Ctd%3E%u65E5%u671F%u65F6%u95F4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5E03%u5C14%3C/td%3E%3Ctd%3E%u5E03%u5C14%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u6574%u6570%u7EC4%3C/td%3E%3Ctd%3E%u6574%u6570%u7EC4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B9E%u6570%u7EC4%3C/td%3E%3Ctd%3E%u5B9E%u6570%u7EC4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u5B57%u7B26%u4E32%u7EC4%3C/td%3E%3Ctd%3E%u5B57%u7B26%u4E32%u7EC4%3C/td%3E%3C/tr%3E%3Ctr%20height%3D%2716px%27%20%3E%3Ctd%3E%u9ED8%u8BA4%3C/td%3E%3Ctd%3E%u9ED8%u8BA4%3C/td%3E%3C/tr%3E%3C/xml%3E%3Cformat%3E%3C/format%3E%3Cblninput%3E%u5426%3C/blninput%3E%3Cblnempty%3E%u5426%3C/blnempty%3E%3Ccheck%3E1%3C/check%3E%3Ctempvalue%3E%u6574%u6570%0D%0A%u5B9E%u6570%0D%0A%u5B57%u7B26%u4E32%0D%0A%u65E5%u671F%0D%0A%u65F6%u95F4%0D%0A%u65E5%u671F%u65F6%u95F4%0D%0A%u5E03%u5C14%0D%0A%u6574%u6570%u7EC4%0D%0A%u5B9E%u6570%u7EC4%0D%0A%u5B57%u7B26%u4E32%u7EC4%0D%0A%u9ED8%u8BA4%3C/tempvalue%3E%3Ctemptext%3E%u6574%u6570%0D%0A%u5B9E%u6570%0D%0A%u5B57%u7B26%u4E32%0D%0A%u65E5%u671F%0D%0A%u65F6%u95F4%0D%0A%u65E5%u671F%u65F6%u95F4%0D%0A%u5E03%u5C14%0D%0A%u6574%u6570%u7EC4%0D%0A%u5B9E%u6570%u7EC4%0D%0A%u5B57%u7B26%u4E32%u7EC4%0D%0A%u9ED8%u8BA4%3C/temptext%3E%3C/code%3E</readonly><visible>是</visible><u></u><v></v><s></s><r></r><columnwidth>100</columnwidth><align>left</align></col></cols>" width="334" height="285" top="6" left="3">
<TABLE id=t style="TABLE-LAYOUT: fixed; LEFT: 0px; POSITION: absolute; TOP: 0px; BORDER-COLLAPSE: collapse" cellSpacing=0 cellPadding=1 frame=box>
<TBODY>
<TR class=fcGridFirstRow>
<TD></TD></TR></TBODY></TABLE></fc:webgrid><BUTTON id=cmdAdd1 style="LEFT: 361px; WIDTH: 55px; POSITION: absolute; TOP: 24px; HEIGHT: 26px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("uf_addfield()")'></BUTTON><BUTTON id=cmdDel1 style="LEFT: 361px; WIDTH: 55px; POSITION: absolute; TOP: 55px; HEIGHT: 26px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("uf_delfield()")'></BUTTON></DIV>
<DIV class=tab-page style="WIDTH: 518px; HEIGHT: 321px">
<H2 class=tab>记录</H2><fc:webgrid id=grid2 onkeydown='bill_ongridkeydown("<grid2><col></col></grid2>")' ondblclick='bill_ongriddblclick("<grid2><col></col></grid2>")' onclick='bill_ongridclick("<grid2><col></col></grid2>")' ParentPos="相对" visible="是" readonly="否" autoappend="否" autowidth="否" autoheight="否" canselect="是" dataset="dataset2" format="<cols><col><fname>aaaa</fname><cname>新建字段</cname><width>10</width><dtype>字符</dtype><readonly>否</readonly><visible>是</visible><u></u><v></v><s></s><r></r><columnwidth>80</columnwidth><align>left</align></col></cols>" width="484" height="263" top="30" left="5">
<TABLE id=t style="TABLE-LAYOUT: fixed; LEFT: 0px; POSITION: absolute; TOP: 0px; BORDER-COLLAPSE: collapse" cellSpacing=0 cellPadding=1 frame=box>
<TBODY>
<TR class=fcGridFirstRow>
<TD></TD></TR></TBODY></TABLE></fc:webgrid><BUTTON id=cmdAdd style="LEFT: 12px; WIDTH: 55px; POSITION: absolute; TOP: 2px; HEIGHT: 26px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("dataset2.Append();")'></BUTTON><BUTTON id=cmdDel style="LEFT: 73px; WIDTH: 55px; POSITION: absolute; TOP: 2px; HEIGHT: 26px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("dataset2.Delete()")'></BUTTON></DIV></DIV>
<SCRIPT>var tab2 = new WebFXTabPane( document.getElementById( "tab2" ) );</SCRIPT>
<fc:dataset id=dataset2 temptable="TMP_DATASET2" opensortno="1" format="<fields><field><fieldname>aaaa</fieldname><datatype>字符</datatype><displaylabel>新建字段</displaylabel><size>10</size><precision>0</precision><fieldkind>数据项</fieldkind><defaultvalue></defaultvalue><displayformat></displayformat><isnull>否</isnull><iskey>否</iskey><valid>否</valid><procvalid>否</procvalid><link>否</link><target></target><href></href><visible>是</visible><primarykey>否</primarykey><fieldvalid></fieldvalid><tag></tag></field></fields>" onValid='bill_ondatasetvalid("<dsid><aaaa></aaaa></dsid>")' onGetText='bill_ondatasetgettext("<dsid><aaaa></aaaa></dsid>")' onSetText='bill_ondatasetsettext("<dsid><aaaa></aaaa></dsid>")'></fc:dataset><BUTTON id=cmdOk style="LEFT: 359px; WIDTH: 55px; POSITION: absolute; TOP: 343px; HEIGHT: 26px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("uf_ok()")'></BUTTON><BUTTON id=cmdClose style="LEFT: 419px; WIDTH: 55px; POSITION: absolute; TOP: 343px; HEIGHT: 26px" onmovestart=moveStart() controltype="button" dropstyle="否" onclick='bill_onclick("CloseBill()")'></BUTTON></DIV></body></html>