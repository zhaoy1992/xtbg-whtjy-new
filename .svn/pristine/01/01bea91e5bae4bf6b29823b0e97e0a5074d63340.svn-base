<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>My First Grid</title>
<link rel="stylesheet" type="text/css" href="css/ui.jqgrid.css" />
<link rel="stylesheet" type="text/css" media="screen" href="css/ui-lightness/jquery-ui-1.8.9.custom.css" />
<script src="js/jquery-1.4.2.min.js" type="text/javascript"></script>
<script src="js/i18n/grid.locale-cn.js" type="text/javascript"></script>  
<script src="js/jquery.jqGrid.min.js" type="text/javascript"></script>
<script src="js/jquery.contextmenu.js" type="text/javascript"></script>
<script src="js/jquery-ui-1.8.9.custom.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" media="screen" href="css/menu/main.css" />
<link rel="stylesheet" type="text/css" media="screen" href="css/menu/contextmenu.css" />
<style>
html, body {
    margin: 0;
    padding: 0;
    font-size: 75%;
}
</style>
</head>

<body>
   <table id="gridTable" class="scroll" width="100%"></table>  
   <div id="pager" class="scroll" style="text-align: center;"></div>

<!--模态窗口  有个小bug会出现滚动条
<div id="dialog-modal" title="Basic modal dialog">
	<p>Adding the modal overlay screen makes the dialog look more prominent because it dims out the page content.</p>
</div>
-->
<div id="dialog" title="Basic dialog" style="display:none">
	<p>This is the default dialog which is useful for displaying information. The dialog window can be moved, resized and closed with the 'x' icon.</p>
	<table id="users">
		<tr><td>1</td></tr>
	</table>
</div>

<script type="text/javascript">
	var dataId = "";
	jQuery("#gridTable").jqGrid({
		datatype: "local",
		height: 250,
		colNames:['Inv No','Date', 'Client', 'Amount','Tax','Total','Notes'],
		colModel:[
			{name:'id',index:'id', width:60, sorttype:"int"},
			{name:'invdate',index:'invdate', width:90, sorttype:"date"},
			{name:'name',index:'name', width:100},
			{name:'amount',index:'amount', width:80, align:"right",sorttype:"float"},
			{name:'tax',index:'tax', width:80, align:"right",sorttype:"float"},		
			{name:'total',index:'total', width:80,align:"right",sorttype:"float"},		
			{name:'note',index:'note', width:150, sortable:false}		
		],
		imgpath: 'themes/sand/images',
		multiselect: true,
		pager: $('#pager'), 
		rowNum:10, 
		rowTotal: 50, 
		//rowList:[10,20,30], 
		toolbar: [true,'top'] ,
		ondblClickRow: function(id){ //双击事件
			//alert('dbclick');
			//alert(id);
			//var rowData = getRowData(id);
			var rowData = $(this).jqGrid('getRowData', id );
			alert(rowData.name);
			showDialog(rowData);
		},
		onRightClickRow: function(id){ //右键事件
			alert('rightclick');
			alert(id);
			jQuery("#gridTable").jqGrid('setSelection', id,true );//选中点击的行
			//showMenu();
			dataId = id;
		},
		afterInsertRow: function(rowid, aData){ //更换数据的颜色
			switch (aData.name) { 
				case 'Client 1': 
					jQuery("#gridTable").jqGrid('setCell',rowid,'total','',{color:'green'}); 
				break; 
				case 'Client 2': 
					jQuery("#gridTable").jqGrid('setCell',rowid,'total','',{color:'red'}); 
				break; 
				case 'test3': 
					jQuery("#gridTable").jqGrid('setCell',rowid,'total','',{color:'blue'}); 
				break; 
			}
		},
		loadComplete:function(){ //根据内容的值 更换行的背景色
        var n = $('#gridTable').getGridParam('records');  //取得现在表格中显示的数据条数
        for(i=0;i<n;i++){	                                     
        	var p = i+1;                                                  //jqgrid的行数是从1开始算起
          var data =$('#gridTable').getRowData(p);                      //取该行的值array
          if(data.name == "test3")                                      //判断符合变色的行
         	{
              //给该行所对应的tr改变背景色，tr的ID是行数。
              //document.getElementById(p).style.backgroundColor="#000000";   
              $("#gridTable tr:eq("+p+")").css("background","000000");
          }
        }
     },
		caption: "Manipulating Array Data"
	});

	var mydata = [
			{id:"1",invdate:"2007-10-01",name:"Client 1",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
			{id:"2",invdate:"2007-10-02",name:"Client 2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
			{id:"3",invdate:"2007-09-01",name:"Client 3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"},
			{id:"4",invdate:"2007-10-04",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
			{id:"5",invdate:"2007-10-05",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
			{id:"6",invdate:"2007-09-06",name:"test3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"},
			{id:"7",invdate:"2007-10-04",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
			{id:"8",invdate:"2007-10-03",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
			{id:"9",invdate:"2007-10-02",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
			{id:"10",invdate:"2007-09-01",name:"test3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"},
			{id:"11",invdate:"2007-10-04",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
			{id:"12",invdate:"2007-10-05",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
			{id:"13",invdate:"2007-09-06",name:"test3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"},
			{id:"14",invdate:"2007-10-04",name:"test",note:"note",amount:"200.00",tax:"10.00",total:"210.00"},
			{id:"15",invdate:"2007-10-03",name:"test2",note:"note2",amount:"300.00",tax:"20.00",total:"320.00"},
			{id:"16",invdate:"2007-09-01",name:"test3",note:"note3",amount:"400.00",tax:"30.00",total:"430.00"}
			];

	for(var i=0;i<=mydata.length;i++)
		$("#gridTable").addRowData(i+1,mydata[i]);

	jQuery("#gridTable").navGrid('#pager',{view:true, del:false});

	$("#t_gridTable").append("<input type='button' value='Click Me' style='height:20px;font-size:-3'/>");
	$("input","#t_gridTable").click(function(){ alert("Hi! I'm added button at this toolbar"); }); 

        var n = $('#gridTable').getGridParam('records');  //取得现在表格中显示的数据条数
        for(i=0;i<n;i++){	                                     
        	var p = i+1;                                                  //jqgrid的行数是从1开始算起
          var data =$('#gridTable').getRowData(p);                      //取该行的值array
          if(data.name == "test3")                                      //判断符合变色的行
         	{
              //给该行所对应的tr改变背景色，tr的ID是行数。
              //document.getElementById(p).style.backgroundColor="#000000";   
              $("#gridTable tr:eq("+p+")").css("background","000000");
          }
        }
/*
	$("#gridTable").jqGrid('navGrid','#pager',{del:true,add:true,edit:true,search:true}).navButtonAdd('#pager',{  
        caption:"表头",    //
        buttonicon:"ui-icon-check",    //
        onClickButton: function(){    //       }, 
        position:"first"  //
    }); 
	*/
	
//---------右键菜单--------------------//		
	$().ready(function() {
		var option = { 
			width: 150, 
			items: [
				{ text: "第一项", icon: "css/menu/images/icons/ico1.gif", alias: "1-1", action: menuAction },
				{ text: "第二项", icon: "css/menu/images/icons/ico2.gif", alias: "1-2", action: menuAction },
				{ text: "第三项", icon: "css/menu/images/icons/ico3.gif", alias: "1-3", action: menuAction },
				{ type: "splitLine" },
				{ text: "组一集合", icon: "css/menu/images/icons/ico4.gif", alias: "1-4", type: "group", width: 170, items: [
					{ text: "组三集合", icon: "css/menu/images/icons/ico4-1.gif", alias: "2-2", type: "group", width: 190, items: [
						{ text: "组3一项", icon: "css/menu/images/icons/ico4-1-1.gif", alias: "3-1", action: menuAction },
						{ text: "组3二项", icon: "css/menu/images/icons/ico4-1-1.gif", alias: "3-2", action: menuAction }
					]},
					{ text: "组1一项", icon: "css/menu/images/icons/ico4-2.gif", alias: "2-1", action: menuAction },
					{ text: "组1二项", icon: "css/menu/images/icons/ico4-3.gif", alias: "2-3", action: menuAction },
					{ text: "组1三项", icon: "css/menu/images/icons/ico4-4.gif", alias: "2-4", action: menuAction }
				]},
				{ type: "splitLine" },
				{ text: "第四项", icon: "css/menu/images/icons/ico5.gif", alias: "1-5", action: menuAction },
				{ text: "组二集合", icon: "css/menu/images/icons/ico6.gif", alias: "1-6", type: "group", width: 180, items: [
					{ text: "组2一项", icon: "css/menu/images/icons/ico6-1.gif", alias: "4-1", action: menuAction },
					{ text: "组2二项", icon: "css/menu/images/icons/ico6-2.gif", alias: "4-2", action: menuAction }
				]}
			], 
			onShow: applyrule,
			onContextMenu: BeforeContextMenu
		};
		
		function menuAction() {
			//alert(this.data.alias);
				alert(dataId);
		}
		
		function applyrule(menu) {               
			if (this.id == "target2") {
				menu.applyrule({ 
					name: "target2",
					disable: true,
					items: ["1-2", "2-3", "2-4", "1-6"]
				});
			}else {
				menu.applyrule({ 
					name: "all",
					disable: true,
					items: []
				});
			}
		}
		
		function BeforeContextMenu() {
			return this.id != "target3";
		}
		
		$("#gridTable").contextmenu(option);
		
	});
//---------右键菜单结束--------------------//		

	function showDialog(rowData){
		// a workaround for a flaw in the demo system (http://dev.jqueryui.com/ticket/4375), ignore!
		/*模态窗口
		$( "#dialog:ui-dialog" ).dialog( "destroy" );
		$( "#dialog-modal" ).dialog({
			height: 140,
			modal: true
		});
		*/
		$('#users').append("<tr><td>"+rowData.name+"</td></tr>"); //将名称动态的加入表格中
		$( "#dialog" ).dialog(); //显示对话框
	};

</script>
</body>
</html>
